#!/bin/zsh

#WHOAREYOU=`env | grep SUDO_USER | awk -F= '{print $2}'`
#echo $WHOAREYOU > /tmp/whoareyou-OpenNetLinkApp.log
WHOAREYOU=`last | head -1 | awk -F' ' '{ print $1 }'`

mkdir /Applications/OpenNetLinkApp.app/Contents/MacOS/wapprove

chown -R $WHOAREYOU /Applications/OpenNetLinkApp.app
chown -R :staff /Applications/OpenNetLinkApp.app
chmod -R g+w /Applications/OpenNetLinkApp.app

cd /Applications/OpenNetLinkApp.app/Contents/PlugIns
tar xvf SGFinderSync.appex.tgz
rm -rf /Applications/SecureGate.app

NETWORK_FILE="/tmp/Network.json"
if [ -e $NETWORK_FILE ]; then
    cp /tmp/Network.json /Applications/OpenNetLinkApp.app/Contents/Resources/wwwroot/conf/
    rm -rf /tmp/Network.json
fi

APPENV_FILE="/tmp/AppEnvSetting.json"
if [ -e $APPENV_FILE ]; then
    cp /tmp/AppEnvSetting.json /Applications/OpenNetLinkApp.app/Contents/Resources/wwwroot/conf/
    rm -rf /tmp/AppEnvSetting.json
fi

exit 0
