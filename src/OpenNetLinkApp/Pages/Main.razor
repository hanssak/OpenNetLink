@page "/LogIn"
@page "/LogIn/{srcLoc}"


@using System.Diagnostics
@using OpenNetLinkApp.Services
@using System.Security.Authentication
@using OpenNetLinkApp.PageEvent
@using OpenNetLinkApp.Models.SGNetwork
@using OpenNetLinkApp.Models.SGSideBar
@using OpenNetLinkApp.Data.SGDicData.SGUnitData
@using HsNetWorkSGData
@using HsNetWorkSG
@using OpenNetLinkApp.Data.SGQuery
@using OpenNetLinkApp.Data.SGSettings
@using OpenNetLinkApp.Models.SGSettings
@using System.Threading
@using System.Runtime.InteropServices
@using NetSparkleUpdater
@using Serilog
@using Serilog.Events
@using AgLogManager
@inject IJSRuntime JSRuntime
@inject NavigationManager MyNavigationManager
@inject XmlConfService XmlConf
@inject HSCmdCenter HSCmdCenter
@inject ISGAppManagerService SGAppMgrSvc
@inject WebWindow Window
@inject PageStatusService pageService


<div id="divLoginMain" class="hold-transition login-page" style="background:url('/images/adminlte/login_full.png')no-repeat center center; background-size:cover;">
    <div class="login-box  p-0 m-0" style="height:413px; width:880px !important;">
        <div class="card p-0" style="border-radius:.7rem !important; background-color:rgba(0,0,0,0.7);">
            <div class="card-body login-card-body  p-0">
                <div class="row1">
                    <div class="col-md-6 login-card-body  pt-0 pb-0" style="border-radius:.7rem 0rem 0rem .7rem !important;">
                        <ul class="full_login_left">
                            <li> <img src="/images/adminlte/SecureGate_logo.png" class="logo"></li>
                            <li>
                                <span>
                                    This is a solution providing the data transmission service <br>
                                    among networks with the highest level of security <br>
                                    in the separated network environment.
                                </span>
                            </li>
                            <li><img src="/images/adminlte/login_full_1.png" class="bg"></li>
                        </ul>
                    </div>

                    <div id="loginCard" class="col-md-6 login-card-body" style="height:413px; border-radius:0rem .7rem .7rem 0rem !important;">

                        <div style=" width:310px;">
                            <p class="login-box-msg1" style=" padding-top:50px;color:#fff; font-size:1.5rem;">@strSystemName <span class="full_txt">@strConNetwork </span></p>

                            <input id="loginId" type="text" class="full-input mb-3 username" placeholder="ID" @bind="id" tabindex="0" autocomplete="off">

                            <input id="loginPw" type="password" class="full-input mb-2 password" placeholder="password" @bind="pw" @onkeyup="keyCheck" tabindex="1" autocomplete="off">

                            <div class="row p-0">
                                @if (bAutoLogin)
                                {
                                    <div class="col-md-12 mt-1 ">
                                        <div class="form-group float-right col-md-4">
                                            <div class="form-check" style="width:150px;">
                                                <input class="form-check-input" type="checkbox" style="margin-top: 0.2rem !important;" tabindex="2" @onclick="CheckStateChange" checked="@bAutoLoginCheck">
                                                <label class="form-check-label" style="color:#fff;width:80px;">@strAutoLogin</label>
                                            </div>
                                        </div>
                                    </div>
                                }
                                <div class="col-md-12 text-center">
                                    @if (bViewBackButton == false)
                                    {
                                        <button id="btnLoginViewBack" @onclick="doLogIn"  class="full_login_btn btn mb-3" tabindex="3" disabled="@bLoginBtnDisable">LOGIN</button>
                                    }
                                    else
                                    {
                                        <div class="col-md-12 text-center">
                                            <table style="width:100%;">
                                                <tr>
                                                    <td>
                                                        <button id="btnLogin" @onclick="doLogIn" class="full_login_btn btn mb-3" tabindex="3" disabled="@bLoginBtnDisable">LOGIN</button>
                                                    </td>
                                                    <td>
                                                        <button id="btnLoginCancel" @onclick="doBack" class="full_cancel_btn btn mb-3" tabindex="4" disabled="@bLoginBtnDisable">Cancel</button>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    }
                                    <div class="full_copy">COPYRIGHT &copy 2020 HANSSAK. ALL RIGHTS RESERVED</div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>

<PWChange @ref="refPWChange"></PWChange>
<PWChangeDefaultPW @ref="refPWChangeDefaultPW"></PWChangeDefaultPW>
<!--<GPKI_Main @ref="refLogInGPKI" Mode="1"></GPKI_Main>-->
<!--<Update_PopUp @ref="refUpdate_PopUp"></Update_PopUp>-->
@code {
    [Parameter]
    public string srcLoc { get; set; }                    // Login Page를 호출한 page에 대한 정보 저장

    public string id { get; set; }
    public string pw { get; set; }

    public string strSystemName = "";
    public string strConNetwork = "";
    public string strAutoLogin = "";
    public bool bViewBackButton = false;  //로그인 취소버튼 표시여부

    ISGUserInfoService sgUserSvr;
    ISGSideBarUIService SideBarUISvc;
    ISGNetworkService NetWorkSvc;
    ISGSiteConfigService siteConfig;
    ISGCtrlSideUIService CtrlSideUISvc;
    public bool bInitBaseLogin = true;
    PWChange refPWChange;
    PWChangeDefaultPW refPWChangeDefaultPW;
    SGSettingsDBProc sgSettingProc;
    public bool bAutoLogin = false;

    public bool bAutoLoginCheck = false;

    public bool bLoginBtnDisable;

    Dictionary<string, SGNetOverData> dicSysIdName = null;

    //Update_PopUp refUpdate_PopUp;

    private static Serilog.ILogger CLog => Serilog.Log.ForContext<Main>();

    //GPKI_Main refLogInGPKI;

    private void keyCheck(KeyboardEventArgs arg)
    {
        if (arg.Key == "Enter")
            doLogIn();
    }

    // 2번째 이상 로그인을 Page형태로 구현할때 사용하려했으나, 사용않함
    private void doBack()
    {

        // 원래 groupID의 Page로 이동
        pageService.m_nCurViewPageGroupID = pageService.m_nLastViewPageGroupID;
        //MyNavigationManager.NavigateTo(pageService.m_strLastPage);

        /*ISGSideBarUI sgSideBar = SideBarUISvc.ActiveMenu;
        foreach (var MenuItem in SideBarUISvc.MenuList)
        {
            if (MenuItem.Child.Count > 0)
            {
            }
            else
            {
            }
        }*/

    }


    /**
    *@biref 
    */
    private void doLogIn()
    {
        try
        {
            JSRuntime.InvokeAsync<object>("loginCursorChange");

            ISGAppConfigService AppConfigSvc = SGAppMgrSvc.AppConfigInfoService;
            string strCurCliVersion = "";
            string strPlatform = "";
            if (AppConfigSvc != null)
            {
                strCurCliVersion = AppConfigSvc.GetSWVersion();
                strCurCliVersion = "OpenNetLink " + strCurCliVersion;
                //strConfirmID = AppConfigSvc.GetSWCommitId();
                //strCurCliVersion = "OpenNetLink " + strCurCliVersion + "+" + strConfirmID;

                strPlatform = AppConfigSvc.GetUpdatePlatform();
                strCurCliVersion = strCurCliVersion + ":" + strPlatform;
                //strCurCliVersion = strCurCliVersion + ":" + "debian";
            }

            if (strCurCliVersion.Equals(""))
                return;
            HSCmdCenter.SetCliVersion(strCurCliVersion);

            CLog.Here().Information("Login Platform  : {0}", strPlatform);
            CLog.Here().Information("Login strCurCliVersion {0}", strCurCliVersion);

            HSCmdCenter.Login(pageService.m_nCurViewPageGroupID, id, pw, strCurCliVersion);
            //HSCmdCenter.Login(0, id, pw, "NetLink 2.01");
        }
        catch (Exception ex)
        {
            Debug.WriteLine(ex.Message);
        }
    }


    /**
    *@biref 
    */
    private void WaitForFocus()
    {
        System.Threading.Thread.Sleep(1000);
        @*if (id.Length == 0)
            {
                object[] param2 = { "loginId" };
                JSRuntime.InvokeAsync<object>("changeFocus", param2);
            }
            else
            {
                object[] param3 = { "loginPw" };
                JSRuntime.InvokeAsync<object>("changeFocus", param3);
            }*@
    }


    /**
    *@biref 
    */
    protected override void OnAfterRender(bool firstRender)
    {
        Thread waitTh = new Thread(WaitForFocus);
        waitTh.Start();
        base.OnAfterRender(firstRender);
    }


    /**
    *@biref 
    */
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        object[] param = { "none" };
        await JSRuntime.InvokeAsync<object>("initLogIn", param);

        await JSRuntime.InvokeAsync<object>("InitDragAndDrop");
        await JSRuntime.InvokeAsync<object>("addMouseDown");
        await JSRuntime.InvokeAsync<object>("addMouseUp");
        await JSRuntime.InvokeAsync<object>("addDragStart");

        int groupID = pageService.m_nCurViewPageGroupID;

        if (firstRender)
        {
            ISGAppConfigService AppConfigSvc = SGAppMgrSvc.AppConfigInfoService;
            if (AppConfigSvc.GetUseGPKILogin(groupID))
            {
                if (srcLoc != "GPKI")
                    MyNavigationManager.NavigateTo("/GPKI_LogIn/1");    // login Mode로 실행
            }
            else
            {

                // ID저장
                if (siteConfig.GetUseLoginIDSave(groupID) == true)
                {
                    string strEncID = "";
                    strEncID = sgSettingProc.GetSettingUID(groupID);
                    if (strEncID == null || strEncID.Equals(""))
                        return;
                    string strID = "";
                    SGRSACrypto sgRSACrypto = new SGRSACrypto();
                    sgRSACrypto.ValueDecrypt(strEncID, out strID);
                    id = strID;
                    StateHasChanged();
                }

                // IDPW자동로그인
                bAutoLogin = siteConfig.GetUseAutoLogin(groupID);
                if (bAutoLogin)
                    StateHasChanged();

                if (bAutoLogin)
                {

                    bAutoLoginCheck = siteConfig.GetUseAutoLoginCheck(groupID);

                    bool bAutoLoginContinue = sgSettingProc.GetSettingAutoLogin(groupID);

                    if (bAutoLoginContinue && srcLoc != "Logout")
                        bLoginBtnDisable = true;

                    if (bAutoLoginCheck)
                        StateHasChanged();

                    if (bAutoLoginContinue)
                    {
                        bAutoLoginCheck = bAutoLoginContinue;
                        if (bAutoLoginCheck)
                            StateHasChanged();

                        string strEncID = "";
                        string strEncPW = "";
                        strEncID = sgSettingProc.GetSettingUID(groupID);
                        strEncPW = sgSettingProc.GetSettingUPW(groupID);
                        if ((strEncID == null || strEncID.Equals("")) || (strEncPW == null || strEncPW.Equals("")))
                        {
                            bLoginBtnDisable = false;
                            StateHasChanged();
                            return;
                        }

                        SGRSACrypto sgRSACrypto = new SGRSACrypto();
                        string strID = "";
                        string strPW = "";
                        sgRSACrypto.ValueDecrypt(strEncID, out strID);
                        id = strID;

                        // Logout 으로 인해 온 상황에서는 PW를 표시하지 않고, 로그인도하지 않음.
                        if (srcLoc != "Logout")
                        {
                            sgRSACrypto.ValueDecrypt(strEncPW, out strPW);
                            pw = strPW;
                        }

                        StateHasChanged();
                        System.Threading.Thread.Sleep(500);

                        if (srcLoc != "Logout")
                            doLogIn();
                        StateHasChanged();
                    }
                }

            }

        }
        await base.OnAfterRenderAsync(firstRender);
    }


    /**
    *@biref 
    */
    protected override void OnInitialized()
    {

        int groupid = pageService.m_nCurViewPageGroupID;


        // GroupID
        //if (pageService.m_nCurViewPageGroupID > 0)
        //    bViewBackButton = true;

        //HSCmdCenter.LoginResult_Event += LoginResult;
        HSCmdCenter.sgPageEvent.SetLoginEventAdd(groupid, LoginResult);
        base.OnInitialized();
        sgUserSvr = SGAppMgrSvc.UserInfoService;
        SideBarUISvc = SGAppMgrSvc.SideBarUIService;
        NetWorkSvc = SGAppMgrSvc.NetworkInfoService;
        siteConfig = SGAppMgrSvc.SiteConfigInfoService;
        CtrlSideUISvc = SGAppMgrSvc.CtrlSideUIService;

        sgSettingProc = SGSettingsDBProc.Instance;

        InitText();

        /*ISGAppConfigService AppConfigSvc = SGAppMgrSvc.AppConfigInfoService;
        if (AppConfigSvc.GetUseGPKILogin(groupid))
        {

        }
        else
        {
            bAutoLogin = siteConfig.GetUseAutoLogin(groupid);
            if (bAutoLogin)
            {
                bAutoLoginCheck = siteConfig.GetUseAutoLoginCheck(groupid);

                if (sgSettingProc.GetSettingAutoLogin(groupid) && srcLoc != "Logout")
                    bLoginBtnDisable = true;
            }

            if (siteConfig.GetUseAutoLogin(groupID) == true)
            {

                bAutoLoginCheck = siteConfig.GetUseAutoLoginCheck(groupID);

                bool bAutoLoginContinue = sgSettingProc.GetSettingAutoLogin(groupID);

                if (bAutoLoginContinue && srcLoc != "Logout")
                    bLoginBtnDisable = true;

                if (bAutoLoginCheck)
                    StateHasChanged();
            }

            if (siteConfig.GetUseLoginIDSave(groupid) == true)
            {
                string strEncID = "";
                strEncID = sgSettingProc.GetSettingUID(groupid);
                if (strEncID == null || strEncID.Equals(""))
                {
                    bLoginBtnDisable = false;
                    return;
                }
                string strID = "";
                SGRSACrypto sgRSACrypto = new SGRSACrypto();
                sgRSACrypto.ValueDecrypt(strEncID, out strID);
                id = strID;
            }
        }*/
    }

    /**
    *@biref 
    */
    public void InitText()
    {
        strSystemName = XmlConf.GetTitle("T_SYSTEMNAME2");                  // 망연계 솔루션
        int groupID = pageService.m_nCurViewPageGroupID;


        @*
            SGData tmpData = null;
            tmpData = HSCmdCenter.GetSGSvrData(groupID);

            if (tmpData != null)
            {
                int systemID = 1;
                string sysID = tmpData.GetBasicTagData("SYSTEMID");
                if (!sysID.Equals(""))
                    systemID = Convert.ToInt32(sysID);
                if (systemID == 1)
                    strConNetwork = XmlConf.GetTitle("T_COMMON_LOGININNER");            // 업무망
                else
                    strConNetwork = XmlConf.GetTitle("T_COMMON_LOGINOUTER");            // 인터넷망
            }
            else
                strConNetwork = XmlConf.GetTitle("T_COMMON_LOGININNER");            // 업무망
        *@


        // 접속하는 망 정보는 NetWork.json 의 string 사용으로 일원화
        List<ISGNetwork> listNetWork = NetWorkSvc.NetWorkInfo;
        for (int nIdx = 0; nIdx < listNetWork.Count; nIdx++)
        {
            if (listNetWork[nIdx].GroupID == groupID)
            {
                strConNetwork = listNetWork[nIdx].FromName;
                break;
            }
        }

        strAutoLogin = XmlConf.GetTitle("T_ETC_AUTOLOGIN_CHECKBOX");        // 자동로그인
    }


    /**
    *@biref 3망일때에는 NetWork.json 파일이 아니라 Server에서 받은 망이름(NETOVERMODE)으로 수정해서 표현
    */
    public void ChangeNetOverTitle(int nGroupID, Dictionary<string, SGNetOverData> dicSystemIdName)
    {

        if (dicSystemIdName == null || dicSystemIdName.Count < 2)
            return;

        // string strNetOverDestTitle = "";

        // NetWork.json 파일이 아니라 Server에서 받은 망이름(NETOVERMODE)으로 전부 수정해서 표현
        List<ISGNetwork> listNetWork = NetWorkSvc.NetWorkInfo;
        /*for (int nIdx = 0; nIdx < listNetWork.Count; nIdx++)
        {
            if (listNetWork[nIdx].GroupID == nGroupID)
            {

                listNetWork[nIdx].FromName = "";
                listNetWork[nIdx].ToName = "";

                foreach (var item in dicSystemIdName)
                {
                    if (item.Value.nIdx != 0 && item.Key.Length > 0)
                    {
                        if (strNetOverDestTitle.Length > 0)
                            strNetOverDestTitle += ",";

                        strNetOverDestTitle += item.Key;
                    }

                    if (item.Value.nIdx == 0 && item.Key.Length > 0)
                    {
                        listNetWork[nIdx].FromName = item.Key;
                    }
                }

                if (strNetOverDestTitle.Length > 0)
                    listNetWork[nIdx].ToName = strNetOverDestTitle;
            }
        }*/

        // 왼쪽 SideBar 에서 도착하는 곳만 "다중망"으로 표현, 시작하는 곳 이름은 Server에서 받은 망이름(NETOVERMODE) 사용
        // Welcome(대쉬보드)에서 표현은 시작망이름은 망이름(NETOVERMODE) 사용, 도착망이름은 망이름(NETOVERMODE)에서 1번째 도달하는 망이름 사용
        for (int nIdx = 0; nIdx < listNetWork.Count; nIdx++)
        {
            if (listNetWork[nIdx].GroupID == nGroupID)
            {

                foreach (var item in dicSystemIdName)
                {
                    if (item.Value.nIdx == 0 && item.Key.Length > 0)
                    {
                        listNetWork[nIdx].FromName = item.Key;
                    }

                    if (item.Value.nIdx == 1 && item.Key.Length > 0)
                    {
                        listNetWork[nIdx].ToName = item.Key;
                    }
                }

                // 다중망 양 끝단이 아닐때는 도착지를 "다중망"으로 표기하지 않음
                if (pageService.m_bIsMultiNetWork == false)
                    listNetWork[nIdx].ToName = XmlConf.GetTitle("T_RECV_SIDE_TITLE");
                return;
            }
        }


    }

    public async void LoginResult(int groupId, PageEventArgs e)
    {
        int ret = e.result;
        if (ret == 0)
        {

            SGLoginData sgLoginData = (SGLoginData)HSCmdCenter.GetLoginData(groupId);

            pageService.ConnectCountAdd(groupId);
            pageService.SetConnectStatus(groupId, true);
            pageService.SetLogoutStatus(groupId, false);

            CLog.Here().Information($"groupID : {groupId} - User Do Login(GPKI_Main), UrlRedirection LogIn State ReSet !!!");
            HsNetWorkSG.HsHttpWatcher.SetLoginOutState(groupId, true);
            

            /*
            if (ClientPatch(sgLoginData))
            {
                string strSvrVersion = sgLoginData.GetServClientVersion();
                refUpdate_PopUp.SetVersionText(strSvrVersion);
                refUpdate_PopUp.SetType(0);
                refUpdate_PopUp.SetLoginUpdateEventAdd(LoginUpdateExe);
                await refUpdate_PopUp.openPopUp();
                return;
            }
            */
            SGUserData sgUserData = (SGUserData)HSCmdCenter.GetUserData(groupId);
            sgUserSvr.SetUserInfo(groupId, sgLoginData, sgUserData);

            // 3중망 정보 적용
            dicSysIdName = new Dictionary<string, SGNetOverData>();

            if (sgLoginData.GetUseOverNetwork2())
            {

                if (sgLoginData.GetOverNetwork2Data(ref dicSysIdName, pageService.m_bIsMultiNetWork))
                {
                    pageService.SetTargetSystemList(groupId, dicSysIdName);

                    // 3중망이상일때, 왼쪽Sidebar 포함 도착망이름 변경
                    if (dicSysIdName != null && dicSysIdName.Count > 1)
                    {
                        ChangeNetOverTitle(groupId, dicSysIdName);
                    }
                }
            }


            InitSideMenu(groupId);

            // MyNavigationManager.NavigateTo("/Welcome");
            ISGAppConfigService AppConfigSvc = SGAppMgrSvc.AppConfigInfoService;

            bool bUseClipBoard = sgLoginData.GetClipboard();
            if (bUseClipBoard)
            {
                List<bool> listModKey = AppConfigSvc.GetClipBoardModifier(groupId);
                char chVKey = AppConfigSvc.GetClipBoardVKey(groupId);

                // 단일 - 다중망일때 처리
                if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))
                {
                    bool bAlt = listModKey[(int)HOTKEY_MOD.ALT];
                    bool bCtrl = listModKey[(int)HOTKEY_MOD.CTRL];
                    bool bShift = listModKey[(int)HOTKEY_MOD.SHIFT];
                    bool bWin = listModKey[(int)HOTKEY_MOD.WINDOW];
                    Window.WinRegClipboardHotKey(groupId, bAlt, bCtrl, bShift, bWin, chVKey);
                }
                else
                {
                    Window.RegClipboardHotKey(groupId,
                                    listModKey[(int)HOTKEY_MOD.ALT],
                                    listModKey[(int)HOTKEY_MOD.CTRL],
                                    listModKey[(int)HOTKEY_MOD.SHIFT],
                                    listModKey[(int)HOTKEY_MOD.WINDOW],
                                    chVKey);
                }

                // 3중망일때, Clipboard 단축키 처리
                if (sgLoginData.GetUseOverNetwork2() && dicSysIdName != null && dicSysIdName.Count > 1)
                {

                    bool bUseClipNetOverALL = true;

                    foreach (var item in dicSysIdName)
                    {
                        // 1번재 상대편 망으로 전송은 위에 기존 Code로 처리
                        if (item.Value.nIdx > 1 && item.Value.bUseClipTrans)
                        {
                            // listModKey = AppConfigSvc.GetClipBoardModifierWhen(groupId);

                            listModKey = AppConfigSvc.GetClipBoardModifierWhenNetOver(groupId, item.Value.nIdx);
                            chVKey = ' ';
                            chVKey = AppConfigSvc.GetClipBoardVKeyWhenNetOver(groupId, item.Value.nIdx, NetWorkSvc.NetWorkInfo.Count, dicSysIdName.Count);

                            if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))
                            {
                                bool bAlt = listModKey[(int)HOTKEY_MOD.ALT];
                                bool bCtrl = listModKey[(int)HOTKEY_MOD.CTRL];
                                bool bShift = listModKey[(int)HOTKEY_MOD.SHIFT];
                                bool bWin = listModKey[(int)HOTKEY_MOD.WINDOW];
                                Window.WinRegClipboardHotKeyNetOver(groupId, bAlt, bCtrl, bShift, bWin, chVKey, item.Value.nIdx);
                            }
                            else
                            {
                                Window.RegClipboardHotKeyNetOver(groupId,
                                                listModKey[(int)HOTKEY_MOD.ALT],
                                                listModKey[(int)HOTKEY_MOD.CTRL],
                                                listModKey[(int)HOTKEY_MOD.SHIFT],
                                                listModKey[(int)HOTKEY_MOD.WINDOW],
                                                chVKey, item.Value.nIdx);
                            }

                            // 3망 사용 중이지 않다가 갑자가 사용으로 설정변경시 단축키 저장
                            CtrlSideUISvc.SetClipBoardHotKeyNetOver(groupId, item.Value.nIdx,
                                                            listModKey[(int)HOTKEY_MOD.WINDOW],
                                                            listModKey[(int)HOTKEY_MOD.CTRL],
                                                            listModKey[(int)HOTKEY_MOD.ALT],
                                                            listModKey[(int)HOTKEY_MOD.SHIFT],
                                                            chVKey);
                        }

                        // 한곳이라도 clipboard 사용하지 않으면 Both 기능 사용않함
                        if (item.Value.nIdx > 0 && item.Value.bUseClipTrans == false)
                            bUseClipNetOverALL = false;
                    }

                    // 3중망 - 동시에 수신망 전체에 전송
                    if (AppConfigSvc.GetUseNetOverAllsend() && bUseClipNetOverALL && NetWorkSvc.NetWorkInfo.Count < 2)
                    {
                        // KKW-3중망, clipboard 단축키 추가작업필요
                        listModKey = AppConfigSvc.GetClipBoardModifierWhenNetOver(groupId, 0);
                        chVKey = ' ';
                        chVKey = AppConfigSvc.GetClipBoardVKeyWhenNetOver(groupId, 0, NetWorkSvc.NetWorkInfo.Count, dicSysIdName.Count);

                        if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))
                        {
                            bool bAlt = listModKey[(int)HOTKEY_MOD.ALT];
                            bool bCtrl = listModKey[(int)HOTKEY_MOD.CTRL];
                            bool bShift = listModKey[(int)HOTKEY_MOD.SHIFT];
                            bool bWin = listModKey[(int)HOTKEY_MOD.WINDOW];
                            Window.WinRegClipboardHotKeyNetOver(groupId, bAlt, bCtrl, bShift, bWin, chVKey, 0);
                        }
                        else
                        {
                            Window.RegClipboardHotKeyNetOver(groupId,
                                            listModKey[(int)HOTKEY_MOD.ALT],
                                            listModKey[(int)HOTKEY_MOD.CTRL],
                                            listModKey[(int)HOTKEY_MOD.SHIFT],
                                            listModKey[(int)HOTKEY_MOD.WINDOW],
                                            chVKey, 0);
                        }

                        // 3망 사용 중이지 않다가 갑자가 사용으로 설정변경시 단축키 저장
                        CtrlSideUISvc.SetClipBoardHotKeyNetOver(groupId, 0,
                                                        listModKey[(int)HOTKEY_MOD.WINDOW],
                                                        listModKey[(int)HOTKEY_MOD.CTRL],
                                                        listModKey[(int)HOTKEY_MOD.ALT],
                                                        listModKey[(int)HOTKEY_MOD.SHIFT],
                                                        chVKey);
                    }

                }



            }


            DateTime dt = sgLoginData.GetSvrTimeConvert();
            pageService.SetSvrTime(groupId, dt);
            bool bAfterApprChkHIde = sgLoginData.GetAfterChkHide();
            bool bAfterApprEnable = sgLoginData.GetUseAfterApprove(dt);
            pageService.SetAfterApprChkHIde(groupId, bAfterApprChkHIde);
            pageService.SetAfterApprEnable(groupId, bAfterApprEnable);

            Int64 DayFileMaxSize = sgLoginData.GetDayFileTransferLimitSize();
            int DayFileMaxCount = sgLoginData.GetDayFileTransferLimitCount();
            Int64 DayClipMaxSize = sgLoginData.GetDayClipboardLimitSize();
            int DayClipMaxCount = sgLoginData.GetDayClipboardLimitCount();
            pageService.SetDayFileAndClipMax(groupId, DayFileMaxSize, DayFileMaxCount, DayClipMaxSize, DayClipMaxCount);

            // 서버에서 받은 화면잠금 시간 설정
            ScreenTimeInitNotiEvent screenTimeInitEvent = HSCmdCenter.sgPageEvent.GetScreenTimeInitNotiEvent();
            if (screenTimeInitEvent != null)
            {
                ConfigArgs config = new ConfigArgs();
                config.ScreenTime = sgLoginData.GetSCRLimit();
                screenTimeInitEvent(groupId, config);
            }

            if (siteConfig.GetUseAutoLogin(groupId) == true)
            {
                if (bAutoLoginCheck)
                {
                    SGRSACrypto sgRSACrypto = new SGRSACrypto();
                    string strEncID = "";
                    string strEncPW = "";
                    if ((!id.Equals("")) & (id != null) & (!pw.Equals("")) & (pw != null))
                    {
                        sgRSACrypto?.ValueEncrypt(id, out strEncID);
                        sgRSACrypto?.ValueEncrypt(pw, out strEncPW);

                        SGSettingData sgSettingData = null;
                        sgSettingData = sgSettingProc.SelectSettingData(groupId);
                        if (sgSettingData == null)
                            sgSettingProc.InsertSettingData(groupId, "", "", "", "", 0);

                        sgSettingProc.SetSettingUID(groupId, strEncID);
                        sgSettingProc.SetSettingUPW(groupId, strEncPW);
                        sgSettingProc.SetSettingAutoLogin(groupId, true);
                    }
                }
            }


            if (siteConfig.GetUseLoginIDSave(groupId) == true)
            {
                SGRSACrypto sgRSACrypto = new SGRSACrypto();
                string strEncID = "";
                sgRSACrypto.ValueEncrypt(id, out strEncID);
                SGSettingData sgSettingData = null;
                sgSettingData = sgSettingProc.SelectSettingData(groupId);
                if (sgSettingData == null)
                    sgSettingProc.InsertSettingData(groupId, "", "", "", "", 0);
                sgSettingProc.SetSettingUID(groupId, strEncID);
            }


            HsNetWork hsNetWork = null;
            hsNetWork = HSCmdCenter.GetConnectNetWork(groupId);
            if (hsNetWork != null)
            {
                pageService.SetSessionKey(groupId, hsNetWork.GetSeedKey());
                pageService.SetCurUserPassWD(groupId, pw);
            }

            if (GetInitPWLogin(groupId) == true)
            {
                pageService.SetPassWDChgType(groupId, ePassWDType.eINITPASSWDCHG);
                refPWChangeDefaultPW.nGroupID = groupId;
                await refPWChangeDefaultPW.openPopUp();
                return;
            }

            if (sgLoginData.GetPasswordExpired() == ePassWDChgType.eNone)
            {
                string strNavigatePathWithGroupID = "";

                if (srcLoc == "GPKI")
                    strNavigatePathWithGroupID = "/GPKI_LogIn/2";    // Register Mode로 실행
                else if (siteConfig.GetUseDashBoard())
                {
                    //strNavigatePathWithGroupID = "/Welcome";
                    strNavigatePathWithGroupID = "/Welcome/";
                    strNavigatePathWithGroupID += groupId.ToString();
                }
                else
                {
                    strNavigatePathWithGroupID = "/Transfer/";
                    strNavigatePathWithGroupID += groupId.ToString();
                }

                MyNavigationManager.NavigateTo(strNavigatePathWithGroupID);


                if (AppConfigSvc.GetStartTrayMove())
                {
                    if (pageService.GetConnectCount(groupId) <= 0)                                                                     // 재접속이 아닐 경우에만 트레이 이동
                    {
                        string strTitle = XmlConf.GetTitle("T_ETC_TRAYMOVE");                                                   // 트레이 이동.
                        string strInfoMsg = XmlConf.GetInfoMsg("I_0051");                                                       // 트레이 아이콘으로 이동합니다.
                        Window.Notification(OS_NOTI.ONLINE, strTitle, strInfoMsg);
                        Window.MoveWebWindowToTray();
                    }
                    else
                        Window.Notification(OS_NOTI.ONLINE, pageService.m_strLoginToastTitle, pageService.m_strLoginToastMsg, "");
                }
                else
                {
                    Window.Notification(OS_NOTI.ONLINE, pageService.m_strLoginToastTitle, pageService.m_strLoginToastMsg, "");
                }

            }
            else if (sgLoginData.GetPasswordExpired() == ePassWDChgType.eEnforce)
            {
                // password 강제변경 창
                pageService.SetPassWDChgType(groupId, ePassWDType.eDAYPASSWDCHG);
                refPWChange.nGroupID = groupId;
                refPWChange.Init();
                await refPWChange.openPopUp();
                return;
            }
            else
            {

                // password 변경권고 창 띄울지 검사
                string strTime = "";
                SGSettingData sgSettingData = null;
                sgSettingData = sgSettingProc.SelectSettingData(groupId);
                if (sgSettingData == null)
                {
                    pageService.SetPassWDChgType(groupId, ePassWDType.eDAYPASSWDCHG);
                    refPWChange.nGroupID = groupId;
                    refPWChange.Init();
                    await refPWChange.openPopUp();
                    return;
                }

                strTime = sgSettingProc.GetSettingDelayDspPw(groupId);
                if (strTime.Equals(""))
                {
                    pageService.SetPassWDChgType(groupId, ePassWDType.eDAYPASSWDCHG);
                    refPWChange.nGroupID = groupId;
                    refPWChange.Init();
                    await refPWChange.openPopUp();
                    return;
                }

                SGPassWDPeriodData sgPassWDData = new SGPassWDPeriodData();
                string strUserSeq = sgUserData.GetUserSequence();
                strTime = sgPassWDData.LoaclPassWDDelayLoadString(strTime, strUserSeq);

                if (strTime.Equals(""))
                {
                    pageService.SetPassWDChgType(groupId, ePassWDType.eDAYPASSWDCHG);
                    refPWChange.nGroupID = groupId;
                    refPWChange.Init();
                    await refPWChange.openPopUp();
                    return;
                }

                DateTime dtLocalTime = DateTime.Parse(strTime);
                DateTime svrDt = sgLoginData.GetSvrTimeDayConvert();

                if (DateTime.Compare(dtLocalTime, svrDt) < 0)
                {
                    pageService.SetPassWDChgType(groupId, ePassWDType.eDAYPASSWDCHG);
                    refPWChange.nGroupID = groupId;
                    refPWChange.Init();
                    await refPWChange.openPopUp();
                    return;
                }
                else
                {

                    string strNavigatePathWithGroupID = "";

                    if (srcLoc == "GPKI")
                        strNavigatePathWithGroupID = "/GPKI_LogIn/2";    // Register Mode로 실행
                    else if (siteConfig.GetUseDashBoard())
                    {
                        strNavigatePathWithGroupID = "/Welcome/";
                        strNavigatePathWithGroupID += groupId.ToString();
                    }
                    else
                    {
                        strNavigatePathWithGroupID = "/Transfer/";
                        strNavigatePathWithGroupID += groupId.ToString();
                    }

                    MyNavigationManager.NavigateTo(strNavigatePathWithGroupID);


                    if (AppConfigSvc.GetStartTrayMove())
                    {
                        if (pageService.GetConnectCount(groupId) <= 0)                                                                     // 재접속이 아닐 경우에만 트레이 이동
                        {
                            string strTitle = XmlConf.GetTitle("T_ETC_TRAYMOVE");                                                   // 트레이 이동.
                            string strInfoMsg = XmlConf.GetInfoMsg("I_0051");                                                       // 트레이 아이콘으로 이동합니다.
                            Window.Notification(OS_NOTI.ONLINE, strTitle, strInfoMsg);
                            Window.MoveWebWindowToTray();
                        }
                        else
                            Window.Notification(OS_NOTI.ONLINE, pageService.m_strLoginToastTitle, pageService.m_strLoginToastMsg, "");
                    }
                    else
                    {
                        Window.Notification(OS_NOTI.ONLINE, pageService.m_strLoginToastTitle, pageService.m_strLoginToastMsg, "");
                    }
                }
            }

            CtrlSideEvent ctrlSideEvent = null;
            ctrlSideEvent = HSCmdCenter.sgPageEvent.GetCtrlSideNotiEvent();
            if (ctrlSideEvent != null)
                ctrlSideEvent();

            // Move WebWindow To Tray.
            //if (AppConfigSvc.GetStartTrayMove()) Window.MoveWebWindowToTray();
        }
        else
        {
            await JSRuntime.InvokeAsync<object>("loginCursorChangeDefault");
            bLoginBtnDisable = false;
            string strPopupMsg = e.strMsg;
            strPopupMsg = strPopupMsg.Replace("/r/n", "<br/>");
            ShowLoginFail(strPopupMsg);
            HSCmdCenter.SendLogOut(groupId, "");
            StateHasChanged();
        }

    }

    private void ShowLoginFail(string strMsg)
    {
        //type: success, info, waring, error 2020/07/02 YKH
        strMsg = strMsg.Replace("/r/n", "<br>");
        object[] param = { "error", strSystemName, strMsg };
        JSRuntime.InvokeAsync<object>("fireToastMessage", param);
    }

    public void InitSideMenu(int groupid)
    {
        string strDataTrans = XmlConf.GetTitle("T_COMMON_FILETRANS_BASIC");                     // 자료전송
        string strFileTrans = XmlConf.GetTitle("T_COMMON_FILETRANS");                           // 파일전송
        string strTransManage = XmlConf.GetTitle("T_COMMON_TRANSMANAGE");                       // 전송관리
        string strApprManage = XmlConf.GetTitle("T_COMMON_APPROVEMANAGE");                      // 결재관리
        string strSecurityApprManage = XmlConf.GetTitle("T_COMMON_APPROVESECURITY");            // 보안결재
        string strClipboard = XmlConf.GetTitle("T_COMMON_CLIPBOARD");                           // 클립보드
        string strClipboardTransManage = XmlConf.GetTitle("T_COMMON_CLIPTRANS");                // 클립보드 관리
        string strClipboardApprManage = XmlConf.GetTitle("T_COMMON_CLIPAPPR");                  // 클립보드 결재
        string strEmail = XmlConf.GetTitle("T_COMMON_EMAIL");                                   // 메일
        string strEmailTransManage = XmlConf.GetTitle("T_COMMON_EMAILMANAGE_GAP");              // 메일 관리
        string strEmailApprManage = XmlConf.GetTitle("T_COMMON_EMAILAPPROVE_GAP");              // 메일 결재
        string strPCURL = XmlConf.GetTitle("T_COMMON_URL");                                     // PCURL
        string strPCURLTransManage = XmlConf.GetTitle("T_COMMON_URLMANAGE");                    // PCURL 관리
        string strPCURLApprManage = XmlConf.GetTitle("T_COMMON_URLAPPROVE");                    // PCURL 결재
        string strEnvSetInfo = XmlConf.GetTitle("T_COMMON_OPTION");                             // 환경설정.
        string strNetSetInfo = XmlConf.GetTitle("T_ETC_CONNTCTINFO_TITLE");                         // 접속환경
        string strBasicSetInfo = XmlConf.GetTitle("T_ETC_BASICSET_TITLE");                      // 기본설정.
        string strBoardNotiInfo = XmlConf.GetTitle("T_COMMON_NOTIFY");                          // 공지사항

        SideBarUISvc.DeleteAllItem();
        List<ISGNetwork> listNetWork = NetWorkSvc.NetWorkInfo;
        int count = listNetWork.Count;


        // 첫번째 접속된곳과 동일하거나, groupid 설정값에 따라 가도록 for 밖으로 빼놓는다
        bool bFileTransMenuUse = false;
        bool bApprMenuUse = false;
        bool bSecurityApprMenuUse = false;
        bool bPCURLUse = false;
        bool bClipBoardApprUse = false;
        bool bEmailUse = false;
        bool bPublicBoard = false;
        bool bBasicConf = false;

        bool bDeputyApprove = false;

        int nUseNetOverFileTrans = -1;  // -1 : 3망상황아님, 0 : 3망상황에서 파일전송 모든곳에 미사용, 1 : 3망상황에서 파일전송 1곳에서라도 사용

        // 파일전송 사용권한 확인
        if (dicSysIdName != null && dicSysIdName.Count > 1)
        {
            nUseNetOverFileTrans = 0;
            foreach (var item in dicSysIdName)
            {

                if ((item.Value.strDestSysid.Length > 0 && item.Value.bUseFileTrans && item.Key.Length > 0) &&
                   ((pageService.m_bIsMultiNetWork && item.Value.nIdx == 1) || (pageService.m_bIsMultiNetWork == false && item.Value.nIdx != 0)))

                //if (item.Value.bUseFileTrans)
                {
                    nUseNetOverFileTrans = 1;
                    break;
                }
            }
        }

        for (int i = 0; i < count; i++)
        {
            int gID = listNetWork[i].GroupID;
            string strNetFromName = listNetWork[i].FromName;
            string strNetToName = listNetWork[i].ToName;

            bool bExpand = false;
            bool bActived = false;
            if (groupid == gID)
            {
                bExpand = true;
                bActived = true;
            }

            SGLoginData sgLoginData = null;
            SGUserData sgUserData = null;
            sgLoginData = (SGLoginData)HSCmdCenter.GetLoginData(i);
            sgUserData = (SGUserData)HSCmdCenter.GetUserData(i);


            if (sgLoginData != null && sgUserData != null)
            {
                bFileTransMenuUse = sgLoginData.GetFileTrans();

                //if (sgLoginData.GetApprove() == true)
                if (pageService.GetUseApproveNetOver(groupid, sgLoginData))  // 3망 정책고려한 결재사용유무 설정
                    if ((sgLoginData.GetApproveProxyRight() == true) || (sgUserData.GetUserApprpos() > 0))
                        bApprMenuUse = true;

                bSecurityApprMenuUse = sgUserData.GetUserPrivacyApprPos();
                bPCURLUse = sgLoginData.GetPCURLUse();
            }

            // 3망 상황 - 파일전송 UI view 설정 확인
            if (nUseNetOverFileTrans > -1)
            {
                if (nUseNetOverFileTrans == 0)
                    bFileTransMenuUse = false;
                else
                    bFileTransMenuUse = true;
            }

            string strRootPath = "/Welcome";
            if (!siteConfig.GetUseDashBoard())
                strRootPath = "/Transfer";

            bEmailUse = siteConfig.GetUseEmailApprove(groupid);
            bPCURLUse = siteConfig.GetUsePCURL(groupid);
            bClipBoardApprUse = siteConfig.GetUseClipApprove(groupid);
            bPublicBoard = siteConfig.GetUsePublicBoard(groupid);
            // bPublicBoard = true;

            bDeputyApprove = false;
            if (sgLoginData != null)
                bDeputyApprove = sgLoginData.GetDeputyApprove();
            bool bCertSend = siteConfig.GetUseCertSend(groupid);
            bool bAutoLogin = siteConfig.GetUseAutoLogin(groupid);

            bBasicConf = (bDeputyApprove | bCertSend | bAutoLogin);

            int nParentID = 0;
            // int nParentID = LastParentID;

            // 우선 모든 메뉴가 나오도록 임시 설정.
            //bFileTransMenuUse = bApprMenuUse = bSecurityApprMenuUse = bPCURLUse = bClipBoardApprUse = bEmailUse = bPublicBoard = true;

            string strNavigatePathWithGroupID = "";
            string strUserSeq = "";
            if (sgUserData != null)
                strUserSeq = sgUserData.GetUserSequence();

            if (pageService.GetConnectStatus(i) == false)
            {

                strNavigatePathWithGroupID = strRootPath;
                strNavigatePathWithGroupID += "/";
                strNavigatePathWithGroupID += gID.ToString();

                SideBarUISvc.AddRoot(groupId: gID, categoryId: LSIDEBAR.MENU_CATE_ROOT, fromName: strNetFromName, toName: strNetToName, icon: "fas fa-cloud-upload-alt", path: strNavigatePathWithGroupID, badgeType: "right badge badge-danger", badgeValue: "N", "", bActived, bExpand, strUserSeq);
                nParentID++;
            }
            else
            {
                // 예전 방식
                /*SideBarUISvc.AddRoot(groupId: gID, categoryId: LSIDEBAR.MENU_CATE_ROOT, fromName: strNetFromName, toName: strNetToName, icon: "fas fa-cloud-upload-alt", path: strRootPath, badgeType: "right badge badge-danger", badgeValue: "N", "", bActived, bExpand)
                    .AddMenu(groupId: gID, Id: nParentID, categoryId: LSIDEBAR.MENU_CATE_FILE, name: "", icon: "fas fa-copy", path: "", badgeType: "left badge badge-warning", bUse: true)                                                                                  // 파일전송
                    .AddSubMenu(groupId: gID, Id: 0, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_FILE, name: strFileTrans, icon: "fas fa-copy", path: "/transfer", badgeType: "right badge badge-warning", bUse: bFileTransMenuUse)                                 // 파일전송
                    .AddSubMenu(groupId: gID, Id: 1, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_FILE, name: strTransManage, icon: "fas fa-copy", path: "/transManage", badgeType: "right badge badge-warning")                                                     // 전송관리
                    .AddSubMenu(groupId: gID, Id: 2, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_FILE, name: strApprManage, icon: "fas fa-copy", path: "/transferApprove", badgeType: "right badge badge-warning", bUse: bApprMenuUse)                              // 결재관리
                    .AddSubMenu(groupId: gID, Id: 3, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_FILE, name: strSecurityApprManage, icon: "fas fa-copy", path: "/securityApprove", badgeType: "right badge badge-warning", bUse: bSecurityApprMenuUse);             // 보안결재관리

                if (bEmailUse)
                {
                    nParentID++;
                    SideBarUISvc.AddMenu(groupId: gID, Id: nParentID, categoryId: LSIDEBAR.MENU_CATE_MAIL, name: "", icon: "fas fa-envelope", path: "", badgeType: "left badge badge-warning", bUse: bEmailUse)                    // 메일 관리
                    .AddSubMenu(groupId: gID, Id: 0, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_MAIL, name: strEmailTransManage, icon: "fas fa-envelope", path: "/mailManage", badgeType: "right badge badge-warning", bUse: bEmailUse)  // 메일 관리
                    .AddSubMenu(groupId: gID, Id: 1, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_MAIL, name: strEmailApprManage, icon: "fas fa-envelope", path: "/mailApprove", badgeType: "right badge badge-warning", bUse: (bEmailUse & bApprMenuUse));      // 메일 결재
                }

                if (bPCURLUse)
                {
                    nParentID++;
                    SideBarUISvc.AddMenu(groupId: gID, Id: nParentID, categoryId: LSIDEBAR.MENU_CATE_PCURL, name: "", icon: "fas fa-globe", path: "", badgeType: "right badge badge-warning", bUse: bPCURLUse)                                                       // PCURL 관리
                        .AddSubMenu(groupId: gID, Id: 0, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_PCURL, name: strPCURLTransManage, icon: "fas fa-globe", path: "/pcurlManage", badgeType: "right badge badge-warning", bUse: bPCURLUse)                                                       // PCURL 관리
                        .AddSubMenu(groupId: gID, Id: 1, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_PCURL, name: strPCURLApprManage, icon: "fas fa-globe", path: "/pcurlApprove", badgeType: "right badge badge-warning", bUse: (bPCURLUse & bApprMenuUse));                                                       // PCURL 결재
                }

                if (bClipBoardApprUse)
                {
                    nParentID++;
                    SideBarUISvc.AddMenu(groupId: gID, Id: nParentID, categoryId: LSIDEBAR.MENU_CATE_CLIP, name: "", icon: "fas fa-object-ungroup", path: "", badgeType: "right badge badge-warning", bUse: bClipBoardApprUse)                                                          // 클립보드 관리
                        .AddSubMenu(groupId: gID, Id: 0, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_CLIP, name: strClipboardTransManage, icon: "fas fa-object-ungroup", path: "/clipBoardManage", badgeType: "right badge badge-warning", bUse: bClipBoardApprUse)                                                          // 클립보드 관리
                        .AddSubMenu(groupId: gID, Id: 1, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_CLIP, name: strClipboardApprManage, icon: "fas fa-object-ungroup", path: "/clipBoardApprove", badgeType: "right badge badge-warning", bUse: (bClipBoardApprUse & bApprMenuUse));                                                         // 클립보드 결재
                }
                nParentID++;

                SideBarUISvc.AddMenu(groupId: gID, Id: nParentID, categoryId: LSIDEBAR.MENU_CATE_ENVSET, name: strNetSetInfo, icon: "fas fa-cog", path: "/viewConf", badgeType: "right badge badge-warning", bUse: true)                                                                         // 접속환경
                    .AddSubMenu(groupId: gID, Id: 0, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_ENVSET, name: strBoardNotiInfo, icon: "fas fa-cog", path: "/publicBoard", badgeType: "right badge badge-warning", bUse: bPublicBoard)                                     // 공지사항
                    .AddSubMenu(groupId: gID, Id: 1, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_ENVSET, name: strNetSetInfo, icon: "fas fa-cog", path: "/viewConf", badgeType: "right badge badge-warning", bUse: true)                                                              // 접속환경
                    .AddSubMenu(groupId: gID, Id: 2, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_ENVSET, name: strBasicSetInfo, icon: "fas fa-cog", path: "/netConf", badgeType: "right badge badge-warning", bUse: bBasicConf);        // 기본설정*/


                strNavigatePathWithGroupID = strRootPath;
                strNavigatePathWithGroupID += "/";
                strNavigatePathWithGroupID += gID.ToString();

                SideBarUISvc.AddRoot(groupId: gID, categoryId: LSIDEBAR.MENU_CATE_ROOT, fromName: strNetFromName, toName: strNetToName, icon: "fas fa-cloud-upload-alt", path: strNavigatePathWithGroupID, badgeType: "right badge badge-danger", badgeValue: "N", "", bActived, bExpand, strUserSeq);

                if (SideBarUISvc.FindMenu(gID, nParentID) == null)
                    SideBarUISvc.AddMenu(groupId: gID, Id: nParentID, categoryId: LSIDEBAR.MENU_CATE_FILE, name: "", icon: "fas fa-copy", path: "", badgeType: "left badge badge-warning", bUse: true, strUserSeq: strUserSeq);

                // 파일전송
                strNavigatePathWithGroupID = "/transfer/";
                strNavigatePathWithGroupID += gID.ToString();
                if (SideBarUISvc.FindSubMenu(gID, nParentID, 0) == null)
                    SideBarUISvc.AddSubMenu(groupId: gID, Id: 0, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_FILE, name: strFileTrans, icon: "fas fa-copy", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: bFileTransMenuUse, strUserSeq: strUserSeq);

                // 전송관리
                strNavigatePathWithGroupID = "/transManage/";
                strNavigatePathWithGroupID += gID.ToString();
                if (SideBarUISvc.FindSubMenu(gID, nParentID, 1) == null)
                    pageService.m_TransMenuArray[gID] = SideBarUISvc.AddSubMenu(groupId: gID, Id: 1, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_FILE, name: strTransManage, icon: "fas fa-copy", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", strUserSeq: strUserSeq);

                // 결재관리
                strNavigatePathWithGroupID = "/transferApprove/";
                strNavigatePathWithGroupID += gID.ToString();
                if (SideBarUISvc.FindSubMenu(gID, nParentID, 2) == null)
                    pageService.m_approveMenuArray[gID] = SideBarUISvc.AddSubMenu(groupId: gID, Id: 2, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_FILE, name: strApprManage, icon: "fas fa-copy", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: bApprMenuUse, strUserSeq: strUserSeq);

                // 보안결재관리
                strNavigatePathWithGroupID = "/securityApprove/";
                strNavigatePathWithGroupID += gID.ToString();
                if (SideBarUISvc.FindSubMenu(gID, nParentID, 3) == null)
                    SideBarUISvc.AddSubMenu(groupId: gID, Id: 3, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_FILE, name: strSecurityApprManage, icon: "fas fa-copy", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: bSecurityApprMenuUse, strUserSeq: strUserSeq);


                if (bEmailUse)
                {
                    // 메일 관리
                    nParentID++;
                    if (SideBarUISvc.FindMenu(gID, nParentID) == null)
                        SideBarUISvc.AddMenu(groupId: gID, Id: nParentID, categoryId: LSIDEBAR.MENU_CATE_MAIL, name: "", icon: "fas fa-envelope", path: "", badgeType: "left badge badge-warning", bUse: bEmailUse, strUserSeq: strUserSeq);

                    // 메일 관리
                    strNavigatePathWithGroupID = "/mailManage/";
                    strNavigatePathWithGroupID += gID.ToString();
                    if (SideBarUISvc.FindSubMenu(gID, nParentID, 0) == null)
                        SideBarUISvc.AddSubMenu(groupId: gID, Id: 0, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_MAIL, name: strEmailTransManage, icon: "fas fa-envelope", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: bEmailUse, strUserSeq: strUserSeq);

                    // 메일 결재
                    strNavigatePathWithGroupID = "/mailApprove/";
                    strNavigatePathWithGroupID += gID.ToString();
                    if (SideBarUISvc.FindSubMenu(gID, nParentID, 1) == null)
                        SideBarUISvc.AddSubMenu(groupId: gID, Id: 1, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_MAIL, name: strEmailApprManage, icon: "fas fa-envelope", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: (bEmailUse & bApprMenuUse), strUserSeq: strUserSeq);
                }

                if (bPCURLUse)
                {
                    // PCURL 관리
                    nParentID++;
                    if (SideBarUISvc.FindMenu(gID, nParentID) == null)
                        SideBarUISvc.AddMenu(groupId: gID, Id: nParentID, categoryId: LSIDEBAR.MENU_CATE_PCURL, name: "", icon: "fas fa-globe", path: "", badgeType: "right badge badge-warning", bUse: bPCURLUse, strUserSeq: strUserSeq);

                    // PCURL 관리
                    strNavigatePathWithGroupID = "/pcurlManage/";
                    strNavigatePathWithGroupID += gID.ToString();
                    if (SideBarUISvc.FindSubMenu(gID, nParentID, 0) == null)
                        SideBarUISvc.AddSubMenu(groupId: gID, Id: 0, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_PCURL, name: strPCURLTransManage, icon: "fas fa-globe", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: bPCURLUse, strUserSeq: strUserSeq);

                    // PCURL 결재
                    strNavigatePathWithGroupID = "/pcurlApprove/";
                    strNavigatePathWithGroupID += gID.ToString();
                    if (SideBarUISvc.FindSubMenu(gID, nParentID, 1) == null)
                        SideBarUISvc.AddSubMenu(groupId: gID, Id: 1, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_PCURL, name: strPCURLApprManage, icon: "fas fa-globe", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: (bPCURLUse & bApprMenuUse), strUserSeq: strUserSeq);
                }

                if (bClipBoardApprUse)
                {
                    // 클립보드 관리
                    nParentID++;
                    if (SideBarUISvc.FindMenu(gID, nParentID) == null)
                        SideBarUISvc.AddMenu(groupId: gID, Id: nParentID, categoryId: LSIDEBAR.MENU_CATE_CLIP, name: "", icon: "fas fa-object-ungroup", path: "", badgeType: "right badge badge-warning", bUse: bClipBoardApprUse, strUserSeq: strUserSeq);

                    // 클립보드 관리
                    strNavigatePathWithGroupID = "/clipBoardManage/";
                    strNavigatePathWithGroupID += gID.ToString();
                    if (SideBarUISvc.FindSubMenu(gID, nParentID, 0) == null)
                        SideBarUISvc.AddSubMenu(groupId: gID, Id: 0, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_CLIP, name: strClipboardTransManage, icon: "fas fa-object-ungroup", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: bClipBoardApprUse, strUserSeq: strUserSeq);

                    // 클립보드 결재
                    strNavigatePathWithGroupID = "/clipBoardApprove/";
                    strNavigatePathWithGroupID += gID.ToString();
                    if (SideBarUISvc.FindSubMenu(gID, nParentID, 1) == null)
                        SideBarUISvc.AddSubMenu(groupId: gID, Id: 1, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_CLIP, name: strClipboardApprManage, icon: "fas fa-object-ungroup", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: (bClipBoardApprUse & bApprMenuUse), strUserSeq: strUserSeq);
                }

                // 접속환경
                nParentID++;
                strNavigatePathWithGroupID = "/viewConf/";
                strNavigatePathWithGroupID += gID.ToString();
                if (SideBarUISvc.FindMenu(gID, nParentID) == null)
                    SideBarUISvc.AddMenu(groupId: gID, Id: nParentID, categoryId: LSIDEBAR.MENU_CATE_ENVSET, name: strNetSetInfo, icon: "fas fa-cog", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: true, strUserSeq: strUserSeq);

                // 공지사항
                strNavigatePathWithGroupID = "/publicBoard/";
                strNavigatePathWithGroupID += gID.ToString();
                if (SideBarUISvc.FindSubMenu(gID, nParentID, 0) == null)
                    SideBarUISvc.AddSubMenu(groupId: gID, Id: 0, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_ENVSET, name: strBoardNotiInfo, icon: "fas fa-cog", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: bPublicBoard, strUserSeq: strUserSeq);

                // 접속환경
                strNavigatePathWithGroupID = "/viewConf/";
                strNavigatePathWithGroupID += gID.ToString();
                if (SideBarUISvc.FindSubMenu(gID, nParentID, 1) == null)
                    SideBarUISvc.AddSubMenu(groupId: gID, Id: 1, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_ENVSET, name: strNetSetInfo, icon: "fas fa-cog", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: true, strUserSeq: strUserSeq);

                // 기본설정
                strNavigatePathWithGroupID = "/netConf/";
                strNavigatePathWithGroupID += gID.ToString();
                if (SideBarUISvc.FindSubMenu(gID, nParentID, 2) == null)
                    SideBarUISvc.AddSubMenu(groupId: gID, Id: 2, parentId: nParentID, categoryId: LSIDEBAR.MENU_CATE_ENVSET, name: strBasicSetInfo, icon: "fas fa-cog", path: strNavigatePathWithGroupID, badgeType: "right badge badge-warning", bUse: bBasicConf, strUserSeq: strUserSeq);

            }

        }

        SideBarUISvc.EmitNotifyStateChangedActMenu();

    }

    public bool GetInitPWLogin(int groupID)
    {
        string strInitPW = siteConfig.GetInitPasswordInfo(groupID);

        SGRSACrypto sgRSACrypto = new SGRSACrypto();

        string strEncPW = "";
        sgRSACrypto.ValueEncrypt(pw, out strEncPW);
        if (strEncPW.Equals(strInitPW))
            return true;
        return false;
    }

    public void CheckStateChange()
    {
        bAutoLoginCheck = (!bAutoLoginCheck);
        if (!bAutoLoginCheck)
        {
            bLoginBtnDisable = false;
            StateHasChanged();
        }
    }

    /*
    public bool ClientPatch(SGLoginData sgLoginData)
    {

        if (sgLoginData == null)
            return false;
        bool bUpdate = sgLoginData.GetClientUpgrade();
        if (!bUpdate)
            return false;

        string strSvrCliVersion = sgLoginData.GetServClientVersion();
        if (strSvrCliVersion.Equals(""))
            return false;
        strSvrCliVersion = strSvrCliVersion.ToUpper();

        string strCliVersion = HSCmdCenter.GetCliVersion();
        if (strCliVersion.Equals(""))
            return false;
        strCliVersion = strCliVersion.ToUpper();

        //return true;

        if (String.Compare(strSvrCliVersion, strCliVersion, comparisonType: StringComparison.OrdinalIgnoreCase) > 0)
        {
            return true;
        }
        else
            return false;

    }
    */

}
