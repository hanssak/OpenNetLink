<?xml version="1.0" encoding="utf-8"?>
<statements>
  <statement id = "ApproveDaoList">
    SELECT * FROM (
    SELECT A.TRANS_SEQ, B.REQ_SEQ, A.DLP, C.USER_ID, C.USER_NAME, C.USER_RANK,
    CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IO_TYPE,
    FUNC_TRANSSTATUS(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSSTATUS,
    A.APPROVE_KIND, B.APPROVE_FLAG, A.TITLE,  TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUEST_TIME,
    TO_CHAR(TO_TIMESTAMP(B.APPR_RES_TIME,'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS'), 'C' AS APPROVETABLEPOS,
    GETAPPROVEPOSSIBLE(B.APPROVE_USER_SEQ, A.TRANS_SEQ) AS APPROVEPOSSIBLE, B.APPROVESTATE,
    CASE WHEN ((SELECT COUNT(*) FROM TBL_FORWARD_INFO WHERE TRANS_SEQ = A.TRANS_SEQ) + (SELECT COUNT(*) FROM TBL_FORWARD_INFO_HIS WHERE TRANS_SEQ = A.TRANS_SEQ)) > 0  THEN '1'
    ELSE '0' END AS FORWARD_TYPE,
    <if test = "NetWorkType == '1'">
      0 AS SRC_SYSTEM_ID, 0 AS DEST_SYSTEM_ID,
    </if>
    <if test = "NetWorkType == '2'">
      D.SRC_SYSTEM_ID, D.DEST_SYSTEM_ID,
    </if>
    COALESCE((SELECT APPROVE_REAL_NAME || ' ' || APPROVE_REAL_RANK FROM TBL_APPROVE_REAL_HIS WHERE REQ_SEQ = B.REQ_SEQ), E.USER_NAME || ' ' || E.USER_RANK) AS APPROVE_REAL_USER_NAME,
    A.DATA_TYPE
    FROM TBL_TRANSFER_REQ_INFO A,
    (
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '2' AS
    APPROVESTATE FROM TBL_APPROVE_HIS
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    #ApprString#
    AND APPROVE_USER_SEQ != USER_SEQ
    UNION ALL
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '1' AS APPROVESTATE
    FROM TBL_APPROVE_INFO
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    AND APPROVE_USER_SEQ != USER_SEQ
    UNION ALL
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '1' AS APPROVESTATE
    FROM TBL_APPROVE_AFTER
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    AND APPROVE_USER_SEQ != USER_SEQ
    ) B,
    <if test = "NetWorkType == '1'">
      TBL_USER_INFO C , TBL_USER_INFO E
    </if>
    <if test = "NetWorkType == '2'">
      TBL_USER_INFO C, TBL_TRANSFER_REQ_SUB_HIS D, TBL_USER_INFO E
    </if>
    WHERE A.TRANS_SEQ = B.TRANS_SEQ AND A.USER_SEQ = C.USER_SEQ AND B.APPROVE_USER_SEQ = E.USER_SEQ AND A.USER_SEQ != B.APPROVE_USER_SEQ
    <if test = "NetWorkType == '2'">
      AND A.TRANS_SEQ = D.TRANS_SEQ
    </if>
    <if test = "IsSecurity == '0'">
      #DataTypeString#
    </if>
    #RequestString#
    AND A.TRANS_FLAG != '6'
    AND  ( SUBSTRING(A.SYSTEM_ID, 1, 1) ='I' OR  SUBSTRING(A.SYSTEM_ID, 1, 1) ='E' )
    UNION ALL
    SELECT A.TRANS_SEQ, B.REQ_SEQ, A.DLP, C.USER_ID, C.USER_NAME, C.USER_RANK,
    CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IO_TYPE,
    FUNC_TRANSSTATUS(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSSTATUS, A.APPROVE_KIND,
    B.APPROVE_FLAG, A.TITLE,
    TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUEST_TIME,
    TO_CHAR(TO_TIMESTAMP(B.APPR_RES_TIME,'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS'), 'H' AS APPROVETABLEPOS, GETAPPROVEPOSSIBLE(B.APPROVE_USER_SEQ, A.TRANS_SEQ) AS APPROVEPOSSIBLE, B.APPROVESTATE,
    CASE WHEN ((SELECT COUNT(*) FROM TBL_FORWARD_INFO WHERE TRANS_SEQ = A.TRANS_SEQ) + (SELECT COUNT(*) FROM TBL_FORWARD_INFO_HIS WHERE TRANS_SEQ = A.TRANS_SEQ)) > 0  THEN '1'
    ELSE '0' END AS FORWARD_TYPE,
    <if test = "NetWorkType == '1'">
      0 AS SRC_SYSTEM_ID, 0 AS DEST_SYSTEM_ID,
    </if>
    <if test = "NetWorkType == '2'">
      D.SRC_SYSTEM_ID, D.DEST_SYSTEM_ID,
    </if>
    COALESCE((SELECT APPROVE_REAL_NAME || ' ' || APPROVE_REAL_RANK FROM TBL_APPROVE_REAL_HIS WHERE REQ_SEQ = B.REQ_SEQ), E.USER_NAME || ' ' || E.USER_RANK) AS APPROVE_REAL_USER_NAME,
    A.DATA_TYPE
    FROM TBL_TRANSFER_REQ_HIS A, (
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '2' AS APPROVESTATE
    FROM TBL_APPROVE_HIS
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    #ApprString#
    AND APPROVE_USER_SEQ != USER_SEQ
    UNION ALL
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '1' AS APPROVESTATE
    FROM TBL_APPROVE_INFO
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    AND APPROVE_USER_SEQ != USER_SEQ
    UNION ALL
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '1' AS APPROVESTATE
    FROM TBL_APPROVE_AFTER
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    AND APPROVE_USER_SEQ != USER_SEQ
    ) B,
    <if test = "NetWorkType == '1'">
      TBL_USER_INFO C , TBL_USER_INFO E
    </if>
    <if test = "NetWorkType == '2'">
      TBL_USER_INFO C, TBL_TRANSFER_REQ_SUB_HIS D, TBL_USER_INFO E
    </if>
    WHERE A.TRANS_SEQ = B.TRANS_SEQ AND A.USER_SEQ = C.USER_SEQ AND B.APPROVE_USER_SEQ = E.USER_SEQ AND A.USER_SEQ != B.APPROVE_USER_SEQ
    <if test = "NetWorkType == '2'">
      AND A.TRANS_SEQ = D.TRANS_SEQ
    </if>
    <if test = "IsSecurity == '0'">
      #DataTypeString#
    </if>
    #RequestString#
    AND  ( SUBSTRING(A.SYSTEM_ID, 1, 1) ='I' OR  SUBSTRING(A.SYSTEM_ID, 1, 1) ='E' )
    ) AS X
    WHERE 1=1
    <if test = "TransKind != ''">
      AND IO_TYPE = '#TransKind#'
    </if>
    <case>
      <when test = "ApprStatus == '1'">
        AND APPROVE_FLAG = '1' AND APPROVESTATE != '2'
      </when>
      <when test = "ApprStatus == '4'">
        AND APPROVE_FLAG = '1' AND APPROVESTATE = '2'
      </when>
      <when test = "ApprStatus != '5' AND ApprStatus != ''">
        AND APPROVE_FLAG = '#ApprStatus#'
      </when>
    </case>
    <if test = "ApprKind != ''">
      AND APPROVE_KIND = '#ApprKind#'
    </if>
    <if test = "Title != ''">
      AND UPPER(TITLE) LIKE UPPER('%' || '#Title#' || '%')
    </if>
    <if test = "ReqUserName != ''">
      AND USER_NAME LIKE '%' || '#ReqUserName#' || '%'
    </if>
    <if test = "Src_system_id != ''">
      AND (SUBSTRING(SRC_SYSTEM_ID,1,1) = '#Src_system_id#')
    </if>
    <if test = "Dest_system_id != ''">
      AND (SUBSTRING(DEST_SYSTEM_ID,1,2) = '#Dest_system_id#')
    </if>
    ORDER BY REQUEST_TIME DESC
    LIMIT #PageListCount# OFFSET (#ViewPageNo# -1) * #PageListCount#
  </statement>

  <statement id = "ApproveDaoCount">
    SELECT COUNT(*) FROM (
    SELECT A.TRANS_SEQ, B.REQ_SEQ, A.DLP, C.USER_ID, C.USER_NAME, C.USER_RANK,
    CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IO_TYPE,
    FUNC_TRANSSTATUS(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSSTATUS,
    A.APPROVE_KIND, B.APPROVE_FLAG, A.TITLE,  TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUEST_TIME,
    TO_CHAR(TO_TIMESTAMP(B.APPR_RES_TIME,'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS'), 'C' AS APPROVETABLEPOS,
    GETAPPROVEPOSSIBLE(B.APPROVE_USER_SEQ, A.TRANS_SEQ) AS APPROVEPOSSIBLE, B.APPROVESTATE,
    CASE WHEN ((SELECT COUNT(*) FROM TBL_FORWARD_INFO WHERE TRANS_SEQ = A.TRANS_SEQ) + (SELECT COUNT(*) FROM TBL_FORWARD_INFO_HIS WHERE TRANS_SEQ = A.TRANS_SEQ)) > 0  THEN '1'
    ELSE '0' END AS FORWARD_TYPE,
    <if test = "NetWorkType == '1'">
      0 AS SRC_SYSTEM_ID, 0 AS DEST_SYSTEM_ID,
    </if>
    <if test = "NetWorkType == '2'">
      D.SRC_SYSTEM_ID, D.DEST_SYSTEM_ID,
    </if>
    COALESCE((SELECT APPROVE_REAL_NAME || ' ' || APPROVE_REAL_RANK FROM TBL_APPROVE_REAL_HIS WHERE REQ_SEQ = B.REQ_SEQ), E.USER_NAME || ' ' || E.USER_RANK) AS APPROVE_REAL_USER_NAME,
    A.DATA_TYPE
    FROM TBL_TRANSFER_REQ_INFO A,
    (
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '2' AS
    APPROVESTATE FROM TBL_APPROVE_HIS
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    #ApprString#
    AND APPROVE_USER_SEQ != USER_SEQ
    UNION ALL
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '1' AS APPROVESTATE
    FROM TBL_APPROVE_INFO
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    AND APPROVE_USER_SEQ != USER_SEQ
    UNION ALL
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '1' AS APPROVESTATE
    FROM TBL_APPROVE_AFTER
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    AND APPROVE_USER_SEQ != USER_SEQ
    ) B,
    <if test = "NetWorkType == '1'">
      TBL_USER_INFO C , TBL_USER_INFO E
    </if>
    <if test = "NetWorkType == '2'">
      TBL_USER_INFO C, TBL_TRANSFER_REQ_SUB_HIS D, TBL_USER_INFO E
    </if>
    WHERE A.TRANS_SEQ = B.TRANS_SEQ AND A.USER_SEQ = C.USER_SEQ AND B.APPROVE_USER_SEQ = E.USER_SEQ AND A.USER_SEQ != B.APPROVE_USER_SEQ
    <if test = "NetWorkType == '2'">
      AND A.TRANS_SEQ = D.TRANS_SEQ
    </if>
    <if test = "IsSecurity == '0'">
      #DataTypeString#
    </if>
    #RequestString#
    AND A.TRANS_FLAG != '6'
    AND  ( SUBSTRING(A.SYSTEM_ID, 1, 1) ='I' OR  SUBSTRING(A.SYSTEM_ID, 1, 1) ='E' )
    UNION ALL
    SELECT A.TRANS_SEQ, B.REQ_SEQ, A.DLP, C.USER_ID, C.USER_NAME, C.USER_RANK,
    CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IO_TYPE,
    FUNC_TRANSSTATUS(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSSTATUS, A.APPROVE_KIND,
    B.APPROVE_FLAG, A.TITLE,
    TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUEST_TIME,
    TO_CHAR(TO_TIMESTAMP(B.APPR_RES_TIME,'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS'), 'H' AS APPROVETABLEPOS, GETAPPROVEPOSSIBLE(B.APPROVE_USER_SEQ, A.TRANS_SEQ) AS APPROVEPOSSIBLE, B.APPROVESTATE,
    CASE WHEN ((SELECT COUNT(*) FROM TBL_FORWARD_INFO WHERE TRANS_SEQ = A.TRANS_SEQ) + (SELECT COUNT(*) FROM TBL_FORWARD_INFO_HIS WHERE TRANS_SEQ = A.TRANS_SEQ)) > 0  THEN '1'
    ELSE '0' END AS FORWARD_TYPE,
    <if test = "NetWorkType == '1'">
      0 AS SRC_SYSTEM_ID, 0 AS DEST_SYSTEM_ID,
    </if>
    <if test = "NetWorkType == '2'">
      D.SRC_SYSTEM_ID, D.DEST_SYSTEM_ID,
    </if>
    COALESCE((SELECT APPROVE_REAL_NAME || ' ' || APPROVE_REAL_RANK FROM TBL_APPROVE_REAL_HIS WHERE REQ_SEQ = B.REQ_SEQ), E.USER_NAME || ' ' || E.USER_RANK) AS APPROVE_REAL_USER_NAME,
    A.DATA_TYPE
    FROM TBL_TRANSFER_REQ_HIS A, (
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '2' AS APPROVESTATE
    FROM TBL_APPROVE_HIS
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    #ApprString#
    AND APPROVE_USER_SEQ != USER_SEQ
    UNION ALL
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '1' AS APPROVESTATE
    FROM TBL_APPROVE_INFO
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    AND APPROVE_USER_SEQ != USER_SEQ
    UNION ALL
    SELECT REQ_SEQ, TRANS_SEQ, APPROVE_USER_SEQ, APPROVE_FLAG, APPR_RES_TIME, '1' AS APPROVESTATE
    FROM TBL_APPROVE_AFTER
    WHERE #SecurityOrderNum#
    AND APPROVE_USER_SEQ IN (
    SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#'
    <if test = "APPROVE_TYPE_SFM == '2'">
      UNION
      SELECT B.USER_SEQ FROM TBL_USER_INFO A, TBL_USER_SFM B WHERE A.USER_ID = '#UserID#' AND A.USER_SEQ = B.SFM_USER_SEQ AND TO_CHAR(NOW(), 'YYYYMMDD') BETWEEN B.FROMDATE AND B.TODATE
    </if>
    )
    AND APPROVE_USER_SEQ != USER_SEQ
    ) B,
    <if test = "NetWorkType == '1'">
      TBL_USER_INFO C , TBL_USER_INFO E
    </if>
    <if test = "NetWorkType == '2'">
      TBL_USER_INFO C, TBL_TRANSFER_REQ_SUB_HIS D, TBL_USER_INFO E
    </if>
    WHERE A.TRANS_SEQ = B.TRANS_SEQ AND A.USER_SEQ = C.USER_SEQ AND B.APPROVE_USER_SEQ = E.USER_SEQ AND A.USER_SEQ != B.APPROVE_USER_SEQ
    <if test = "NetWorkType == '2'">
      AND A.TRANS_SEQ = D.TRANS_SEQ
    </if>
    <if test = "IsSecurity == '0'">
      #DataTypeString#
    </if>
    #RequestString#
    AND  ( SUBSTRING(A.SYSTEM_ID, 1, 1) ='I' OR  SUBSTRING(A.SYSTEM_ID, 1, 1) ='E' )
    ) AS X
    WHERE 1=1
    <if test = "TransKind != ''">
      AND IO_TYPE = '#TransKind#'
    </if>
    <case>
      <when test = "ApprStatus == '1'">
        AND APPROVE_FLAG = '1' AND APPROVESTATE != '2'
      </when>
      <when test = "ApprStatus == '4'">
        AND APPROVE_FLAG = '1' AND APPROVESTATE = '2'
      </when>
      <when test = "ApprStatus != '5' AND ApprStatus != ''">
        AND APPROVE_FLAG = '#ApprStatus#'
      </when>
    </case>
    <if test = "ApprKind != ''">
      AND APPROVE_KIND = '#ApprKind#'
    </if>
    <if test = "Title != ''">
      AND UPPER(TITLE) LIKE UPPER('%' || '#Title#' || '%')
    </if>
    <if test = "ReqUserName != ''">
      AND USER_NAME LIKE '%' || '#ReqUserName#' || '%'
    </if>
    <if test = "Src_system_id != ''">
      AND (SUBSTRING(SRC_SYSTEM_ID,1,1) = '#Src_system_id#')
    </if>
    <if test = "Dest_system_id != ''">
      AND (SUBSTRING(DEST_SYSTEM_ID,1,2) = '#Dest_system_id#')
    </if>
  </statement>

  <statement id = "TransferDaoList">
    SELECT * FROM (
    SELECT A.TRANS_SEQ AS TRANSSEQ, A.DLP AS DLP, CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IOTYPE,
    FUNC_TRANSSTATUS(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSSTATUS, A.APPROVE_KIND AS APPROVEKIND, A.APPROVE_FLAG AS APPROVEFLAG, A.TITLE AS TITLE, A.FILE_SIZE AS FILESIZE,
    FUNC_TRANSFILEPOS(A.SYSTEM_ID, A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSPOS, TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUESTTIME,
    '1' AS DOWNPOSSIBLE, TO_CHAR(TO_TIMESTAMP(COALESCE(B.EXPIRED_DATE, '00000000'),'YYYYMMDD'),'YYYY-MM-DD') AS EXPIREDDATE, COALESCE(B.DOWNLOAD_COUNT, 0) AS DOWNCOUNT,
    <if test = "NetWorkType == '1'">
      GET_FORWARD_FLAG(A.TRANS_SEQ) AS DATAFORWARDED,
      (SELECT AA.USER_ID || '|' || AA.USER_RANK  || '|' || BB.DEPT_NAME FROM TBL_USER_INFO AA, TBL_DEPT_INFO BB WHERE AA.DEPT_SEQ = BB.DEPT_SEQ AND AA.USER_SEQ = A.USER_SEQ) AS ORGUSERINFO,
      A.RECV_POS AS RECVPOS, '0' AS RECEIVETYPE, A.DATA_TYPE AS DATATYPE
      FROM TBL_TRANSFER_REQ_INFO A
      LEFT OUTER JOIN VIEW_BACKUP_PERIOD B ON (A.TRANS_SEQ = B.TRANS_SEQ)
    </if>
    <if test = "NetWorkType == '2'">
      GET_FORWARD_FLAG(A.TRANS_SEQ) AS DATAFORWARDED, GET_USER_INFO(A.USER_SEQ) AS ORGUSERINFO, A.RECV_POS AS RECVPOS, '0' AS RECEIVETYPE
      ,C.SRC_SYSTEM_ID, C.DEST_SYSTEM_ID
      FROM TBL_TRANSFER_REQ_INFO A
      LEFT OUTER JOIN VIEW_BACKUP_PERIOD B ON (A.TRANS_SEQ = B.TRANS_SEQ)
      LEFT OUTER JOIN TBL_TRANSFER_REQ_SUB_HIS C ON (A.TRANS_SEQ = C.TRANS_SEQ)
    </if>
    WHERE A.USER_SEQ IN (SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#')
    #DataTypeCheckString#
    #DateTimeCheckString#
    UNION ALL
    SELECT A.TRANS_SEQ AS TRANSSEQ, A.DLP AS DLP, CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IOTYPE,
    FUNC_TRANSSTATUS(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSSTATUS, A.APPROVE_KIND AS APPROVEKIND, A.APPROVE_FLAG AS APPROVEFLAG, A.TITLE AS TITLE, A.FILE_SIZE AS FILESIZE,
    FUNC_TRANSFILEPOS(A.SYSTEM_ID, A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSPOS, TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUESTTIME,
    COALESCE(B.DOWNLOAD_ALIVE, '0') AS DOWNPOSSIBLE, TO_CHAR(TO_TIMESTAMP(COALESCE(B.EXPIRED_DATE, '00000000'),'YYYYMMDD'),'YYYY-MM-DD') AS EXPIREDDATE,
    COALESCE(B.DOWNLOAD_COUNT, 1) AS DOWNCOUNT,
    <if test = "NetWorkType == '1'">
      GET_FORWARD_FLAG(A.TRANS_SEQ) AS DATAFORWARDED,
      (SELECT AA.USER_ID || '|' || AA.USER_RANK  || '|' || BB.DEPT_NAME FROM TBL_USER_INFO AA, TBL_DEPT_INFO BB WHERE AA.DEPT_SEQ = BB.DEPT_SEQ AND AA.USER_SEQ = A.USER_SEQ) AS ORGUSERINFO,
      A.RECV_POS AS RECVPOS, '0' AS RECEIVETYPE, A.DATA_TYPE AS DATATYPE
      FROM TBL_TRANSFER_REQ_HIS A
      LEFT OUTER JOIN VIEW_BACKUP_PERIOD B ON (A.TRANS_SEQ = B.TRANS_SEQ)
    </if>
    <if test = "NetWorkType == '2'">
      GET_FORWARD_FLAG(A.TRANS_SEQ) AS DATAFORWARDED, GET_USER_INFO(A.USER_SEQ) AS ORGUSERINFO, A.RECV_POS AS RECVPOS, '0' AS RECEIVETYPE
      ,C.SRC_SYSTEM_ID, C.DEST_SYSTEM_ID
      FROM TBL_TRANSFER_REQ_HIS A
      LEFT OUTER JOIN VIEW_BACKUP_PERIOD B ON (A.TRANS_SEQ = B.TRANS_SEQ)
      LEFT OUTER JOIN TBL_TRANSFER_REQ_SUB_HIS C ON (A.TRANS_SEQ = C.TRANS_SEQ)
    </if>
    WHERE A.USER_SEQ IN (SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#')
    #DataTypeCheckString#
    #DateTimeCheckString#
    UNION ALL
    SELECT A.TRANS_SEQ AS TRANSSEQ, A.DLP AS DLP, CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IOTYPE,
    FUNC_TRANSSTATUS_FWD(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG, '1', B.DOWNLOAD_COUNT, A.APPROVE_FLAG) AS TRANSSTATUS,
    A.APPROVE_KIND AS APPROVEKIND, A.APPROVE_FLAG AS APPROVEFLAG, A.TITLE AS TITLE, A.FILE_SIZE AS FILESIZE,
    FUNC_TRANSFILEPOS(A.SYSTEM_ID, A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSPOS, TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUESTTIME,
    '1' AS DOWNPOSSIBLE, TO_CHAR(TO_TIMESTAMP('00000000','YYYYMMDD'),'YYYY-MM-DD') AS EXPIREDDATE, 0 AS DOWNCOUNT,
    <if test = "NetWorkType == '1'">
      '2' AS DATAFORWARDED,
      (SELECT AA.USER_ID || '|' || AA.USER_RANK  || '|' || BB.DEPT_NAME FROM TBL_USER_INFO AA, TBL_DEPT_INFO BB WHERE AA.DEPT_SEQ = BB.DEPT_SEQ AND AA.USER_SEQ = A.USER_SEQ) AS ORGUSERINFO,
      A.RECV_POS AS RECVPOS, '1' AS RECEIVETYPE, A.DATA_TYPE AS DATATYPE
      FROM VIEW_TRANSFER_ALL A
      INNER JOIN TBL_FORWARD_INFO B ON (A.TRANS_SEQ = B.TRANS_SEQ)
    </if>
    <if test = "NetWorkType == '2'">
      '2' AS DATAFORWARDED, GET_USER_INFO(A.USER_SEQ) AS ORGUSERINFO, A.RECV_POS AS RECVPOS, '1' AS RECEIVETYPE
      ,C.SRC_SYSTEM_ID, C.DEST_SYSTEM_ID
      FROM VIEW_TRANSFER_ALL A
      INNER JOIN TBL_FORWARD_INFO B ON (A.TRANS_SEQ = B.TRANS_SEQ)
      LEFT OUTER JOIN TBL_TRANSFER_REQ_SUB_HIS C ON (A.TRANS_SEQ = C.TRANS_SEQ)
    </if>
    WHERE B.USER_SEQ IN (SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#')
    #DataTypeCheckString#
    #DateTimeCheckString#
    UNION ALL
    SELECT A.TRANS_SEQ AS TRANSSEQ, A.DLP  AS DLP, CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IOTYPE,
    FUNC_TRANSSTATUS_FWD(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG, '2', B.DOWNLOAD_COUNT, A.APPROVE_FLAG) AS TRANSSTATUS,
    A.APPROVE_KIND AS APPROVEKIND, A.APPROVE_FLAG AS APPROVEFLAG, A.TITLE AS TITLE, A.FILE_SIZE AS FILESIZE,
    FUNC_TRANSFILEPOS(A.SYSTEM_ID, A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSPOS, TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUESTTIME,
    '0' AS DOWNPOSSIBLE, TO_CHAR(TO_TIMESTAMP('00000000','YYYYMMDD'),'YYYY-MM-DD') AS EXPIREDDATE, 1 AS DOWNCOUNT,
    <if test = "NetWorkType == '1'">
      '2' AS DATAFORWARDED,
      (SELECT AA.USER_ID || '|' || AA.USER_RANK  || '|' || BB.DEPT_NAME FROM TBL_USER_INFO AA, TBL_DEPT_INFO BB WHERE AA.DEPT_SEQ = BB.DEPT_SEQ AND AA.USER_SEQ = A.USER_SEQ) AS ORGUSERINFO,
      A.RECV_POS AS RECVPOS, '1' AS RECEIVETYPE, A.DATA_TYPE AS DATATYPE
      FROM VIEW_TRANSFER_ALL A
      INNER JOIN TBL_FORWARD_INFO_HIS B ON (A.TRANS_SEQ = B.TRANS_SEQ)
    </if>
    <if test = "NetWorkType == '2'">
      '2' AS DATAFORWARDED, GET_USER_INFO(A.USER_SEQ) AS ORGUSERINFO, A.RECV_POS AS RECVPOS, '1' AS RECEIVETYPE
      ,C.SRC_SYSTEM_ID, C.DEST_SYSTEM_ID
      FROM VIEW_TRANSFER_ALL A
      INNER JOIN TBL_FORWARD_INFO_HIS B ON (A.TRANS_SEQ = B.TRANS_SEQ)
      LEFT OUTER JOIN TBL_TRANSFER_REQ_SUB_HIS C ON (A.TRANS_SEQ = C.TRANS_SEQ)
    </if>
    WHERE B.USER_SEQ IN (SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#')
    #DataTypeCheckString#
    #DateTimeCheckString#
    ) AS X
    WHERE 1=1
    <if test = "TransKind == '1' OR TransKind == '2'">
      AND IOTYPE = '#TransKind#'
    </if>
    <if test = "TransStatus == 'W'">
      AND  APPROVEFLAG != '3'
    </if>
    <if test = "TransStatus == 'C'">
      AND (TRANSSTATUS = '#TransStatus#' OR  APPROVEFLAG = '3' )
    </if>
    <else>
      <if test = "TransStatus != ''">
        AND TRANSSTATUS = '#TransStatus#'
      </if>
    </else>
    <case>
      <when test = "ApprStatus == '4'">
        AND  TRANSSTATUS = 'C'
        AND  APPROVEFLAG != '2'
        AND  APPROVEFLAG != '3'
      </when>
      <when test = "ApprStatus == '1'">
        AND APPROVEFLAG = '#ApprStatus#' AND TRANSSTATUS != 'C'
      </when>
      <when test = "ApprStatus != ''">
        AND APPROVEFLAG = '#ApprStatus#'
      </when>
    </case>
    <if test = "Title != ''">
      AND UPPER(TITLE) LIKE UPPER('%' || '#Title#' || '%')
    </if>
    <if test = "NetWorkType == '2'">
      <if test = "Dest_system_id != ''">
        AND SUBSTRING(DEST_SYSTEM_ID,1,2) = '#Dest_system_id#'
      </if>
    </if>
    ORDER BY REQUESTTIME DESC
    LIMIT #PageListCount# OFFSET (#ViewPageNo# -1) * #PageListCount#
  </statement>

  <statement id = "TransferDaoCount">
    SELECT COUNT(*) FROM (
    SELECT A.TRANS_SEQ AS TRANSSEQ, A.DLP AS DLP, CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IOTYPE,
    FUNC_TRANSSTATUS(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSSTATUS, A.APPROVE_KIND AS APPROVEKIND, A.APPROVE_FLAG AS APPROVEFLAG, A.TITLE AS TITLE, A.FILE_SIZE AS FILESIZE,
    FUNC_TRANSFILEPOS(A.SYSTEM_ID, A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSPOS, TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUESTTIME,
    '1' AS DOWNPOSSIBLE, TO_CHAR(TO_TIMESTAMP(COALESCE(B.EXPIRED_DATE, '00000000'),'YYYYMMDD'),'YYYY-MM-DD') AS EXPIREDDATE, COALESCE(B.DOWNLOAD_COUNT, 0) AS DOWNCOUNT,
    <if test = "NetWorkType == '1'">
      GET_FORWARD_FLAG(A.TRANS_SEQ) AS DATAFORWARDED,
      (SELECT AA.USER_ID || '|' || AA.USER_RANK  || '|' || BB.DEPT_NAME FROM TBL_USER_INFO AA, TBL_DEPT_INFO BB WHERE AA.DEPT_SEQ = BB.DEPT_SEQ AND AA.USER_SEQ = A.USER_SEQ) AS ORGUSERINFO,
      A.RECV_POS AS RECVPOS, '0' AS RECEIVETYPE, A.DATA_TYPE AS DATATYPE
      FROM TBL_TRANSFER_REQ_INFO A
      LEFT OUTER JOIN VIEW_BACKUP_PERIOD B ON (A.TRANS_SEQ = B.TRANS_SEQ)
    </if>
    <if test = "NetWorkType == '2'">
      GET_FORWARD_FLAG(A.TRANS_SEQ) AS DATAFORWARDED, GET_USER_INFO(A.USER_SEQ) AS ORGUSERINFO, A.RECV_POS AS RECVPOS, '0' AS RECEIVETYPE
      ,C.SRC_SYSTEM_ID, C.DEST_SYSTEM_ID
      FROM TBL_TRANSFER_REQ_INFO A
      LEFT OUTER JOIN VIEW_BACKUP_PERIOD B ON (A.TRANS_SEQ = B.TRANS_SEQ)
      LEFT OUTER JOIN TBL_TRANSFER_REQ_SUB_HIS C ON (A.TRANS_SEQ = C.TRANS_SEQ)
    </if>
    WHERE A.USER_SEQ IN (SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#')
    #DataTypeCheckString#
    #DateTimeCheckString#
    UNION ALL
    SELECT A.TRANS_SEQ AS TRANSSEQ, A.DLP AS DLP, CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IOTYPE,
    FUNC_TRANSSTATUS(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSSTATUS, A.APPROVE_KIND AS APPROVEKIND, A.APPROVE_FLAG AS APPROVEFLAG, A.TITLE AS TITLE, A.FILE_SIZE AS FILESIZE,
    FUNC_TRANSFILEPOS(A.SYSTEM_ID, A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSPOS, TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUESTTIME,
    COALESCE(B.DOWNLOAD_ALIVE, '0') AS DOWNPOSSIBLE, TO_CHAR(TO_TIMESTAMP(COALESCE(B.EXPIRED_DATE, '00000000'),'YYYYMMDD'),'YYYY-MM-DD') AS EXPIREDDATE,
    COALESCE(B.DOWNLOAD_COUNT, 1) AS DOWNCOUNT,
    <if test = "NetWorkType == '1'">
      GET_FORWARD_FLAG(A.TRANS_SEQ) AS DATAFORWARDED,
      (SELECT AA.USER_ID || '|' || AA.USER_RANK  || '|' || BB.DEPT_NAME FROM TBL_USER_INFO AA, TBL_DEPT_INFO BB WHERE AA.DEPT_SEQ = BB.DEPT_SEQ AND AA.USER_SEQ = A.USER_SEQ) AS ORGUSERINFO,
      A.RECV_POS AS RECVPOS, '0' AS RECEIVETYPE, A.DATA_TYPE AS DATATYPE
      FROM TBL_TRANSFER_REQ_HIS A
      LEFT OUTER JOIN VIEW_BACKUP_PERIOD B ON (A.TRANS_SEQ = B.TRANS_SEQ)
    </if>
    <if test = "NetWorkType == '2'">
      GET_FORWARD_FLAG(A.TRANS_SEQ) AS DATAFORWARDED, GET_USER_INFO(A.USER_SEQ) AS ORGUSERINFO, A.RECV_POS AS RECVPOS, '0' AS RECEIVETYPE
      ,C.SRC_SYSTEM_ID, C.DEST_SYSTEM_ID
      FROM TBL_TRANSFER_REQ_HIS A
      LEFT OUTER JOIN VIEW_BACKUP_PERIOD B ON (A.TRANS_SEQ = B.TRANS_SEQ)
      LEFT OUTER JOIN TBL_TRANSFER_REQ_SUB_HIS C ON (A.TRANS_SEQ = C.TRANS_SEQ)
    </if>
    WHERE A.USER_SEQ IN (SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#')
    #DataTypeCheckString#
    #DateTimeCheckString#
    UNION ALL
    SELECT A.TRANS_SEQ AS TRANSSEQ, A.DLP AS DLP, CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IOTYPE,
    FUNC_TRANSSTATUS_FWD(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG, '1', B.DOWNLOAD_COUNT, A.APPROVE_FLAG) AS TRANSSTATUS,
    A.APPROVE_KIND AS APPROVEKIND, A.APPROVE_FLAG AS APPROVEFLAG, A.TITLE AS TITLE, A.FILE_SIZE AS FILESIZE,
    FUNC_TRANSFILEPOS(A.SYSTEM_ID, A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSPOS, TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUESTTIME,
    '1' AS DOWNPOSSIBLE, TO_CHAR(TO_TIMESTAMP('00000000','YYYYMMDD'),'YYYY-MM-DD') AS EXPIREDDATE, 0 AS DOWNCOUNT,
    <if test = "NetWorkType == '1'">
      '2' AS DATAFORWARDED,
      (SELECT AA.USER_ID || '|' || AA.USER_RANK  || '|' || BB.DEPT_NAME FROM TBL_USER_INFO AA, TBL_DEPT_INFO BB WHERE AA.DEPT_SEQ = BB.DEPT_SEQ AND AA.USER_SEQ = A.USER_SEQ) AS ORGUSERINFO,
      A.RECV_POS AS RECVPOS, '1' AS RECEIVETYPE, A.DATA_TYPE AS DATATYPE
      FROM VIEW_TRANSFER_ALL A
      INNER JOIN TBL_FORWARD_INFO B ON (A.TRANS_SEQ = B.TRANS_SEQ)
    </if>
    <if test = "NetWorkType == '2'">
      '2' AS DATAFORWARDED, GET_USER_INFO(A.USER_SEQ) AS ORGUSERINFO, A.RECV_POS AS RECVPOS, '1' AS RECEIVETYPE
      ,C.SRC_SYSTEM_ID, C.DEST_SYSTEM_ID
      FROM VIEW_TRANSFER_ALL A
      INNER JOIN TBL_FORWARD_INFO B ON (A.TRANS_SEQ = B.TRANS_SEQ)
      LEFT OUTER JOIN TBL_TRANSFER_REQ_SUB_HIS C ON (A.TRANS_SEQ = C.TRANS_SEQ)
    </if>
    WHERE B.USER_SEQ IN (SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#')
    #DataTypeCheckString#
    #DateTimeCheckString#
    UNION ALL
    SELECT A.TRANS_SEQ AS TRANSSEQ, A.DLP  AS DLP, CASE WHEN SUBSTRING(A.SYSTEM_ID, 1, 1)='I' THEN '1' ELSE '2' END AS IOTYPE,
    FUNC_TRANSSTATUS_FWD(A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG, '2', B.DOWNLOAD_COUNT, A.APPROVE_FLAG) AS TRANSSTATUS,
    A.APPROVE_KIND AS APPROVEKIND, A.APPROVE_FLAG AS APPROVEFLAG, A.TITLE AS TITLE, A.FILE_SIZE AS FILESIZE,
    FUNC_TRANSFILEPOS(A.SYSTEM_ID, A.TRANS_FLAG, A.RECV_FLAG, A.PCTRANS_FLAG) AS TRANSPOS, TO_CHAR(TO_TIMESTAMP(SUBSTRING(A.REQUEST_TIME, 1, 14),'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') AS REQUESTTIME,
    '0' AS DOWNPOSSIBLE, TO_CHAR(TO_TIMESTAMP('00000000','YYYYMMDD'),'YYYY-MM-DD') AS EXPIREDDATE, 1 AS DOWNCOUNT,
    <if test = "NetWorkType == '1'">
      '2' AS DATAFORWARDED,
      (SELECT AA.USER_ID || '|' || AA.USER_RANK  || '|' || BB.DEPT_NAME FROM TBL_USER_INFO AA, TBL_DEPT_INFO BB WHERE AA.DEPT_SEQ = BB.DEPT_SEQ AND AA.USER_SEQ = A.USER_SEQ) AS ORGUSERINFO,
      A.RECV_POS AS RECVPOS, '1' AS RECEIVETYPE, A.DATA_TYPE AS DATATYPE
      FROM VIEW_TRANSFER_ALL A
      INNER JOIN TBL_FORWARD_INFO_HIS B ON (A.TRANS_SEQ = B.TRANS_SEQ)
    </if>
    <if test = "NetWorkType == '2'">
      '2' AS DATAFORWARDED, GET_USER_INFO(A.USER_SEQ) AS ORGUSERINFO, A.RECV_POS AS RECVPOS, '1' AS RECEIVETYPE
      ,C.SRC_SYSTEM_ID, C.DEST_SYSTEM_ID
      FROM VIEW_TRANSFER_ALL A
      INNER JOIN TBL_FORWARD_INFO_HIS B ON (A.TRANS_SEQ = B.TRANS_SEQ)
      LEFT OUTER JOIN TBL_TRANSFER_REQ_SUB_HIS C ON (A.TRANS_SEQ = C.TRANS_SEQ)
    </if>
    WHERE B.USER_SEQ IN (SELECT USER_SEQ FROM TBL_USER_INFO WHERE USER_ID = '#UserID#')
    #DataTypeCheckString#
    #DateTimeCheckString#
    ) AS X
    WHERE 1=1
    <if test = "TransKind == '1' OR TransKind == '2'">
      AND IOTYPE = '#TransKind#'
    </if>
    <if test = "TransStatus == 'W'">
      AND  APPROVEFLAG != '3'
    </if>
    <if test = "TransStatus == 'C'">
      AND (TRANSSTATUS = '#TransStatus#' OR  APPROVEFLAG = '3' )
    </if>
    <else>
      <if test = "TransStatus != ''">
        AND TRANSSTATUS = '#TransStatus#'
      </if>
    </else>
    <case>
      <when test = "ApprStatus == '4'">
        AND  TRANSSTATUS = 'C'
        AND  APPROVEFLAG != '2'
        AND  APPROVEFLAG != '3'
      </when>
      <when test = "ApprStatus == '1'">
        AND APPROVEFLAG = '#ApprStatus#' AND TRANSSTATUS != 'C'
      </when>
      <when test = "ApprStatus != ''">
        AND APPROVEFLAG = '#ApprStatus#'
      </when>
    </case>
    <if test = "Title != ''">
      AND UPPER(TITLE) LIKE UPPER('%' || '#Title#' || '%')
    </if>
    <if test = "NetWorkType == '2'">
      <if test = "Dest_system_id != ''">
        AND SUBSTRING(DEST_SYSTEM_ID,1,2) = '#Dest_system_id#'
      </if>
    </if>
  </statement>

  <statement id = "SFMModifyDelete">Hsck_Transaction:DELETE FROM TBL_USER_SFM WHERE USER_SEQ = #userSeq#\n</statement>

  <statement id = "SFMModifyInsert">INSERT INTO TBL_USER_SFM VALUES (#userSeq# , #ApprUserSeq#, '#stStartTime#', '#stEndTime#',  CAST (to_char(now(), 'YYYYMMDDHH24MISS') AS VARCHAR), #userSeq# )\n</statement>

  <statement id = "SFMApprover">
    SELECT * FROM FUNC_SFM_APPROVE_SEARCH(#userSeq#)
  </statement>

  <statement id = "SFMDeptCount">
    SELECT (CASE WHEN D.LIMIT_SFM_NUM IS NULL THEN '3' ELSE D.LIMIT_SFM_NUM END) LIMITCNT
    FROM TBL_DEPT_INFO D, TBL_USER_INFO U
    WHERE D.DEPT_SEQ=U.DEPT_SEQ
    AND U.USER_SEQ = #userSeq#
  </statement>

  <statement id = "SFMApproverRight">
    SELECT * FROM FUNC_SFM_USER_APPROVE_RIGHT(#userSeq#)
  </statement>

  <statement id = "DeptApprLineSearch">
    SELECT * FROM FUNC_USERINFO_SEARCH('#strUserName#', '#strTeamName#', '#strTeamCode#', '#strApprPos#', '#strSysID#')
  </statement>

  <statement id = "UserConfirm">
    SELECT * FROM func_nl_getuserconfirm_v3('#strUserSeq#', '#strTeamCode#', '#strApprPos#')
  </statement>

  <statement id = "ReceiverSearchQuery">
    select a.user_id, a.user_name, b.dept_seq, b.dept_name, a.user_position, a.user_rank, a.part_owner,
    a.apprpos, a.user_seq, a.dlp_approve
    from tbl_user_info a
    join tbl_dept_info b on b.dept_seq = a.dept_seq
    where a.user_id != '#stSenderId#'
    <if test = "strUserName != ''">
      and a.user_name like '%%#strUserName#%%'
    </if>
    <if test = "strDeptName != ''">
      and b.dept_name like '%%#strDeptName#%%'
    </if>
    <if test = "strDeptSeq != ''">
      and b.dept_seq = '#strDeptSeq#'
    </if>
    limit 100
  </statement>

  <statement id = "SecurityApprover">
    SELECT AA.USER_ID, AA.USER_NAME,AA.DEPT_SEQ, BB.DEPT_NAME,
    AA.USER_POSITION, AA.USER_RANK, AA.APPRPOS, AA.APPRPOS_EX, AA.USER_SEQ, AA.DLP_APPROVE
    FROM TBL_USER_INFO AA, TBL_DEPT_INFO BB
    WHERE USER_SEQ IN (
    SELECT USER_SEQ AS USER_SEQ FROM TBL_USER_INFO
    WHERE (DLP_APPROVE = '1' AND USER_SEQ != #userSeq#)
    <if test = "bSFM == '1'">
      UNION
      SELECT SFM_USER_SEQ AS USER_SEQ FROM TBL_USER_SFM A
      WHERE A.USER_SEQ IN (SELECT USER_SEQ FROM TBL_USER_INFO WHERE DLP_APPROVE = '1'  AND USER_SEQ != #userSeq#)
    </if>
    <if test = "isDept == '1'">
      )
      AND AA.DEPT_SEQ = BB.DEPT_SEQ AND AA.USE_STATUS = '1' AND AA.ACCOUNT_EXPIRES > TO_CHAR(NOW(), 'YYYYMMDD')
      AND BB.DEPT_NAME = '#dept#' AND AA.USER_NAME LIKE '%%#apprName#%%'
    </if>
    <else>
      )
      AND AA.DEPT_SEQ = BB.DEPT_SEQ AND AA.USE_STATUS = '1' AND AA.ACCOUNT_EXPIRES > TO_CHAR(NOW(), 'YYYYMMDD')
      AND BB.DEPT_NAME LIKE '%%#dept#%%' AND AA.USER_NAME LIKE '%%#apprName#%%'
    </else>
  </statement>

  <statement id = "AgentBlock">insert into tbl_agent_block values(#strUserSeq#,'#strSystemType#','#strBlockType#','#strBlockReason#',Now())</statement>

  <statement id = "DayFileTransInfo">
    SELECT U.USER_ID, SUM(F.FILE_SIZE) AS FS, COUNT(*) AS CNT
    FROM (
    SELECT 'H' AS TPOS, TRANS_SEQ, REQUEST_TIME, USER_SEQ, TRANS_FLAG, RECV_FLAG, PCTRANS_FLAG,APPROVE_FLAG, SYSTEM_ID
    FROM TBL_TRANSFER_REQ_HIS H
    WHERE TRANS_SEQ BETWEEN '#strDate#0000000000' AND '#strDate#9999999999'
    AND DATA_TYPE = 0
    UNION ALL
    SELECT 'C' AS TPOS, TRANS_SEQ, REQUEST_TIME, USER_SEQ, TRANS_FLAG, RECV_FLAG, PCTRANS_FLAG,APPROVE_FLAG, SYSTEM_ID
    FROM TBL_TRANSFER_REQ_INFO T
    WHERE TRANS_SEQ BETWEEN '#strDate#0000000000' AND '#strDate#9999999999'
    AND DATA_TYPE = 0
    ) T
    , TBL_USER_INFO U
    , (
    SELECT TRANS_SEQ, SUM(F.FILE_SIZE) AS FILE_SIZE
    FROM TBL_FILE_LIST_HIS F WHERE FILE_SEQ BETWEEN '#strDate#0000000000' AND '#strDate#9999999999'
    GROUP BY F.TRANS_SEQ
    ) F
    WHERE T.TRANS_SEQ=F.TRANS_SEQ
    AND T.REQUEST_TIME BETWEEN '#strDate#0000' AND '#strDate#235959'
    AND U.USER_SEQ=T.USER_SEQ
    AND U.USER_SEQ='#strUserSeq#'
    AND FUNC_TRANSSTATUS(T.TRANS_FLAG, T.RECV_FLAG, T.PCTRANS_FLAG) NOT IN ('C', 'F')
    AND T.APPROVE_FLAG !='3'
    AND SUBSTRING(T.SYSTEM_ID, 1, 2)='#strSystem#'
    GROUP BY U.USER_ID
  </statement>

  <statement id = "DayClipboardInfo">
    SELECT USER_ID,  SUM(DATA_SIZE) AS DATA_SIZE, COUNT(*) AS CNT
    FROM TBL_CLIPBOARD_HIS
    WHERE WORK_ID BETWEEN '#strDate#0000000000' AND '#strDate#9999999999'
    AND SUBSTRING(SYSTEM_ID, 1,2)='#strSystem#'
    AND DATA_TYPE IN ('1', '2', '4')
    AND USER_ID = (SELECT USER_ID FROM TBL_USER_INFO WHERE USER_SEQ='#strUserSeq#')
    GROUP BY USER_ID
  </statement>

  <statement id = "UnzipCheckDepth">
    SELECT CAST(SUBSTRING(SYSTEM_ID, 1, 1)||'_'||TAG AS VARCHAR) TAG, TAG_VALUE
    FROM TBL_SYSTEM_ENV
    WHERE SUBSTRING(SYSTEM_ID, 4, 1)='1'
    AND TAG IN ('CLIENT_ZIP_DEPTH')
    ORDER BY SYSTEM_ID DESC
  </statement>

  <statement id = "DashboardTransReqCountQuery">
    select COUNT(*) reqcount from tbl_transfer_req_his where user_seq = '#strUserSeq#' and request_time BETWEEN '#strFromDate#' AND '#strToDate#'
  </statement>

  <statement id = "PasswdChgDay">
    select passwdexpired from tbl_user_info where user_seq='#strUserSeq#'
  </statement>

  <statement id = "SGNotify">
    SELECT * FROM FUNC_NL_BOARDNOTIFY('#strUserID#', '#strPreDate#')
  </statement>

  <statement id = "ApproveAfterCount">
    SELECT * FROM FUNC_NL_GETAFTERAPPROVEWAITUSERCOUNT('#strUserList#')
  </statement>

  <statement id = "SGNotifyStatus">
    SELECT * FROM FUNC_NL_BOARDREADSTATUS(#strNotifySeq#, '#strUserID#', '#strNomore#')
  </statement>

  <statement id = "systemEnvDataS">
    SELECT CAST(SUBSTRING(SYSTEM_ID, 1, 1)||'_'||TAG AS VARCHAR) TAG, TAG_VALUE FROM TBL_SYSTEM_ENV WHERE SUBSTRING(SYSTEM_ID, 4, 1)='1' AND TAG IN (#strTagNames#) ORDER BY SYSTEM_ID DESC
  </statement>

  <statement id = "ZipDepthSQLsystemEnv">
    SELECT CAST(SUBSTRING(SYSTEM_ID, 1, 1)||'_'||TAG AS VARCHAR) TAG, TAG_VALUE FROM TBL_SYSTEM_ENV WHERE SUBSTRING(SYSTEM_ID, 4, 1)='1' AND TAG IN ('CLIENT_ZIP_DEPTH') ORDER BY SYSTEM_ID DESC
  </statement>

  <statement id = "TransferInfoPrivacy">
    SELECT A.TRANS_SEQ, A.DATA_TYPE,B.FILE_NAME, B.FILE_SIZE, B.FILE_KIND, B.DLP, C.*
    FROM TBL_TRANSFER_REQ_INFO A
    INNER JOIN TBL_FILE_LIST_HIS B ON A.TRANS_SEQ = B.TRANS_SEQ
    INNER JOIN TBL_PRIVACY_HIS C ON B.FILE_SEQ = C.FILE_SEQ AND B.TRANS_SEQ = C.TRANS_SEQ
    WHERE A.TRANS_SEQ = '#transSeq#'
  </statement>

  <statement id = "OLEMimeList">
    SELECT MIMETYPE, TYPE FROM TBL_FILE_OLE_MIMETYPE
  </statement>

  <statement id = "SendFileMaxLenInfo">
    <if test = "pushType == '1'">
      SELECT O_TRANS_SEQ, O_TITLE, O_LEN, O_FSIZE, 1 as O_TYPE, O_APPROVE_FLAG FROM FUNC_NL_MAXFILELENGTHFORWARD(#strTransSeq#)
    </if>
    <else>
      SELECT O_TRANS_SEQ, O_TITLE, O_LEN, O_FSIZE, 0 as O_TYPE FROM FUNC_NL_MAXFILELENGTH(#strTransSeq#)
    </else>
  </statement>

  <statement id = "DeptInfo">
    SELECT * FROM TBL_DEPT_INFO WHERE DEPT_NAME = '#deptName#'
  </statement>

  <statement id = "SkipFileListSet">
    SELECT * FROM func_nl_skipfilelistset('#systemid#', '#g_strFileName#', '#lfileSize#', '#strReasonData#', '#userSeq#', '#strsha384#', '#g_ninterLockFlag#')
  </statement>

  <statement id = "SkipFileCount">
    SELECT COUNT(*) AS count FROM TBL_SKIP_FILE_LIST WHERE USER_SEQ = '#userSeq#' AND SKIP_FLAG != '3'
  </statement>

  <statement id = "SkipFileList">
    SELECT FILE_SEQ, SYSTEM_ID, FILE_NAME, FILE_SIZE,
    to_char(to_timestamp(APPR_REQ_TIME,'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') as request_time,
    (CASE WHEN APPR_RES_TIME IS NULL THEN '-' WHEN APPR_RES_TIME ='' THEN '-' WHEN APPR_RES_TIME =' ' THEN '-' ELSE to_char(to_timestamp(APPR_RES_TIME,'YYYYMMDDHH24MISS'), 'YYYY-MM-DD HH24:MI:SS') END ) APPR_RES_TIME,
    (CASE WHEN EXPIRED_DATE IS NULL THEN '-' WHEN EXPIRED_DATE ='' THEN '-' WHEN EXPIRED_DATE =' ' THEN '-' ELSE to_char(to_timestamp(EXPIRED_DATE,'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') END ) EXPIRED_DATE,
    (CASE WHEN SKIP_DESC IS NULL THEN '-' WHEN SKIP_DESC ='' THEN '-' WHEN SKIP_DESC =' ' THEN '-' ELSE SKIP_DESC END ) SKIP_DESC, INTERLOCK_FLAG, SKIP_FLAG,
    CHECKSUM_VAL FROM TBL_SKIP_FILE_LIST WHERE USER_SEQ = '#userSeq#' AND SKIP_FLAG != '3' ORDER BY FILE_SEQ DESC LIMIT #pageListCount# OFFSET (#viewPageNo# - 1) * #pageListCount#
  </statement>

  <statement id = "MailApproveDaoDetail">
    SELECT func_email_detail(#seq#)
  </statement>

  <statement id = "MailApproveDaoList">
    SELECT * FROM
    <if test = "APPROVE_TYPE_SFM == 'XXX'">
      FUNC_EMAIL_APPROVEINFOTYPEFM_OPEN
    </if>
    <else>
      FUNC_EMAIL_APPROVEINFO_OPEN
    </else>
    ('#UserID#','#SearchStartDate#','#SearchEndDate#', '#ApproveKind#', '#TransKind#','#ApprStatus#','#TransStatus#', '#Dlp#', '#Sender#', '#Receiver#', '#Title#', '0', '#PageListCount#', '#ViewPageNo#')
  </statement>

  <statement id = "MailApproveDaoCount">
    SELECT COUNT(*) FROM
    <if test = "APPROVE_TYPE_SFM == 'XXX'">
      FUNC_EMAIL_APPROVEINFOTYPEFM_OPEN
    </if>
    <else>
      FUNC_EMAIL_APPROVEINFO_OPEN
    </else>
    ('#UserID#','#SearchStartDate#','#SearchEndDate#', '#ApproveKind#', '#TransKind#','#ApprStatus#','#TransStatus#', '#Dlp#', '#Sender#', '#Receiver#', '#Title#', '0', '', '')
  </statement>

  <statement id = "MailManageDaoDetail">
    SELECT func_email_detail(#seq#)
  </statement>

  <statement id = "MailManageDaoList">
    SELECT * FROM FUNC_EMAIL_TRANSFERINFO_OPEN('#UserID#','#SearchStartDate#','#SearchEndDate#', '#ApproveKind#', '#TransKind#','#ApprStatus#','#TransStatus#', '#Dlp#', '#Receiver#', '#Title#', '0', '#PageListCount#', '#ViewPageNo#')
  </statement>

  <statement id = "MailManageDaoCount">
    SELECT COUNT(*) FROM FUNC_EMAIL_TRANSFERINFO_OPEN('#UserID#','#SearchStartDate#','#SearchEndDate#', '#ApproveKind#', '#TransKind#','#ApprStatus#','#TransStatus#', '#Dlp#', '#Receiver#', '#Title#', '0', '', '')
  </statement>
  <statement id = "FileExceptionCancel">
    UPDATE TBL_SKIP_FILE_LIST SET SKIP_FLAG='3' WHERE FILE_SEQ=#strFileSeq# AND USER_SEQ=#userSeq#\n
  </statement>
  <statement id = "SearchURLList">
    SELECT a.url AS URL, b.codename AS STAT FROM tbl_url_whitelist a
    LEFT OUTER JOIN tbl_code_info b ON ('C051' = b.basecode and a.stat = b.code)
    <if test = "strSearchURL != ''">
      WHERE a.url like '%%#strSearchURL#%%'
    </if>
    LIMIT 100
  </statement>
  <statement id = "AgentHashFailLog">
    INSERT INTO TBL_ALARM_HIS VALUES(0, '#systemId#', '1005', '#version#', TO_CHAR(NOW(), 'YYYYMMDDHH24MISS'), '1', 'CLIENT AGENT 무결성 오류입니다. CLIENT ID=#strUserID#,   IP ADDRESS=#ipAddr#(#ipAddr#)')
  </statement>
</statements>